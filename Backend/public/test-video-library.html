<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è§†é¢‘åº“æ•°æ®æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f7fa;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #409eff;
            border-bottom: 2px solid #409eff;
            padding-bottom: 10px;
        }
        .video-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #fafafa;
        }
        .thumbnail {
            width: 200px;
            height: 112px;
            object-fit: cover;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            color: #f56c6c;
            font-weight: bold;
        }
        .success {
            color: #67c23a;
            font-weight: bold;
        }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ¬ è§†é¢‘åº“æ•°æ®æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>1. API æ•°æ®æµ‹è¯•</h2>
        <button onclick="testAPI()">æµ‹è¯• API</button>
        <div id="api-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. ç¼©ç•¥å›¾åŠ è½½æµ‹è¯•</h2>
        <button onclick="testThumbnails()">æµ‹è¯•ç¼©ç•¥å›¾</button>
        <div id="thumbnail-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. è§†é¢‘å¡ç‰‡æ¸²æŸ“æµ‹è¯•</h2>
        <div id="video-cards"></div>
    </div>

    <script>
        async function testAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = '<p>æ­£åœ¨è¯·æ±‚...</p>';
            
            try {
                const response = await fetch('/api/admin/videos?limit=8&offset=0');
                const data = await response.json();
                
                if (data.status) {
                    result.innerHTML = `
                        <p class="success">âœ… API è¯·æ±‚æˆåŠŸ!</p>
                        <p>æ€»è§†é¢‘æ•°: ${data.data.total}</p>
                        <p>è¿”å›è§†é¢‘æ•°: ${data.data.videos.length}</p>
                        <pre>${JSON.stringify(data.data.videos[0], null, 2)}</pre>
                    `;
                    
                    // è‡ªåŠ¨æ¸²æŸ“è§†é¢‘å¡ç‰‡
                    renderVideoCards(data.data.videos);
                } else {
                    result.innerHTML = `<p class="error">âŒ API è¿”å›å¤±è´¥: ${data.message}</p>`;
                }
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        async function testThumbnails() {
            const result = document.getElementById('thumbnail-result');
            result.innerHTML = '<p>æ­£åœ¨æµ‹è¯•ç¼©ç•¥å›¾åŠ è½½...</p>';
            
            try {
                const response = await fetch('/api/admin/videos?limit=3&offset=0');
                const data = await response.json();
                
                if (data.status && data.data.videos.length > 0) {
                    let html = '<p class="success">âœ… è·å–åˆ°è§†é¢‘æ•°æ®,æµ‹è¯•ç¼©ç•¥å›¾:</p>';
                    
                    for (const video of data.data.videos) {
                        const thumbnailUrl = `/api${video.thumbnail_url}`;
                        html += `
                            <div class="video-card">
                                <p><strong>è§†é¢‘ ID:</strong> ${video.id}</p>
                                <p><strong>æ ‡é¢˜:</strong> ${video.title}</p>
                                <p><strong>ç¼©ç•¥å›¾è·¯å¾„:</strong> ${video.thumbnail_url}</p>
                                <p><strong>å®Œæ•´URL:</strong> ${thumbnailUrl}</p>
                                <img src="${thumbnailUrl}" 
                                     class="thumbnail" 
                                     onerror="this.style.border='2px solid red'; this.alt='âŒ åŠ è½½å¤±è´¥'"
                                     onload="this.style.border='2px solid green'">
                            </div>
                        `;
                    }
                    
                    result.innerHTML = html;
                } else {
                    result.innerHTML = '<p class="error">âŒ æ²¡æœ‰è§†é¢‘æ•°æ®</p>';
                }
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function formatDuration(seconds) {
            if (!seconds || seconds <= 0) return '0:00';
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'æœªçŸ¥';
            const date = new Date(dateString);
            const now = new Date();
            const diff = now.getTime() - date.getTime();
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (days === 0) return 'ä»Šå¤©';
            if (days === 1) return 'æ˜¨å¤©';
            if (days < 7) return `${days}å¤©å‰`;
            if (days < 30) return `${Math.floor(days / 7)}å‘¨å‰`;
            return date.toLocaleDateString('zh-CN');
        }
        
        function renderVideoCards(videos) {
            const container = document.getElementById('video-cards');
            let html = '<h3>æ¸²æŸ“çš„è§†é¢‘å¡ç‰‡:</h3>';
            
            for (const video of videos) {
                const thumbnailUrl = `/api${video.thumbnail_url}`;
                html += `
                    <div class="video-card">
                        <img src="${thumbnailUrl}" class="thumbnail" alt="${video.title}">
                        <h4>ğŸ“¹ ${video.title}</h4>
                        <p>ğŸ“… ${formatDate(video.created_at)}</p>
                        <p>â±ï¸ ${formatDuration(video.duration)}</p>
                        <p>ğŸ¬ çŠ¶æ€: ${video.status}</p>
                        <p style="font-size: 12px; color: #999;">ID: ${video.id}</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            testAPI();
        };
    </script>
</body>
</html>
