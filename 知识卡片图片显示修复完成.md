# çŸ¥è¯†å¡ç‰‡å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜ - ä¿®å¤å®Œæˆ

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ä»£ç†é…ç½®ä¿®å¤
**æ–‡ä»¶**: `Frontend/vite.config.ts`

æ·»åŠ äº† `/admin` è·¯å¾„çš„ä»£ç†é…ç½®ï¼š
```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true
    },
    '/admin': {  // æ–°å¢
      target: 'http://localhost:3000',
      changeOrigin: true
    },
    '/uploads': {
      target: 'http://localhost:3000',
      changeOrigin: true,
      secure: false
    }
  }
}
```

### 2. å›¾ç‰‡è·¯å¾„å¤„ç†ç»Ÿä¸€åŒ–

ä¿®å¤äº†ä»¥ä¸‹ 5 ä¸ªæ–‡ä»¶ä¸­çš„å›¾ç‰‡ URL å¤„ç†é€»è¾‘ï¼š

#### âœ… EditPage.vue
```typescript
// ä¸å†æ·»åŠ  apiBaseUrlï¼Œè®© Vite ä»£ç†å¤„ç†
let imageUrl = url;
if (!url.startsWith('http') && !url.startsWith('/')) {
  imageUrl = '/' + url;
}
```

#### âœ… KnowledgeCardDisplay.vue
```typescript
// åŒæ ·çš„å¤„ç†é€»è¾‘
let imageUrl = url;
if (!url.startsWith('http') && !url.startsWith('/')) {
  imageUrl = '/' + url;
}
```

#### âœ… KnowledgeCardPopup.vue
```typescript
// ç»Ÿä¸€å¤„ç†
let imageUrl = url;
if (!url.startsWith('http') && !url.startsWith('/')) {
  imageUrl = '/' + url;
}
```

#### âœ… KnowledgeCardModal.vue
```typescript
// ç»Ÿä¸€å¤„ç†
let imageUrl = url;
if (!url.startsWith('http') && !url.startsWith('/')) {
  imageUrl = '/' + url;
}
```

#### âœ… MarkdownEditor.vue (Toast UI Editor)
```typescript
// ä¿®å¤ä¸Šä¼ æ¥å£è·¯å¾„
const response = await fetch('/admin/videos/upload-image', {
  method: 'POST',
  body: formData,
})

// ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„ç›¸å¯¹è·¯å¾„
const imageUrl = data.url // /uploads/images/xxx.png
callback(imageUrl, fileName)
```

### 3. ç¯å¢ƒé…ç½®
**æ–‡ä»¶**: `Frontend/.env.local` âœ… å·²å­˜åœ¨
```bash
VITE_API_BASE_URL=http://localhost:3000
```

### 4. æœåŠ¡å™¨çŠ¶æ€
- âœ… åç«¯æœåŠ¡å™¨: http://localhost:3000 (è¿è¡Œä¸­)
- âœ… å‰ç«¯æœåŠ¡å™¨: http://localhost:5173 (è¿è¡Œä¸­)
- âœ… æ•°æ®åº“è¿æ¥: æ­£å¸¸

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### ç¬¬ 1 æ­¥: æµ‹è¯•åç«¯å›¾ç‰‡æœåŠ¡
åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®æŸä¸ªå›¾ç‰‡ï¼ˆå¦‚æœå·²ç»ä¸Šä¼ è¿‡ï¼‰:
```
http://localhost:3000/uploads/images/xxx.png
```
**æœŸæœ›ç»“æœ**: èƒ½çœ‹åˆ°å›¾ç‰‡

### ç¬¬ 2 æ­¥: æµ‹è¯• Vite ä»£ç†
åœ¨æµè§ˆå™¨ä¸­è®¿é—®:
```
http://localhost:5173/
```
æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)ï¼Œåœ¨ Console ä¸­æ‰§è¡Œ:
```javascript
fetch('/uploads/images/xxx.png')
  .then(r => console.log('ä»£ç†çŠ¶æ€:', r.status, r.statusText))
  .catch(e => console.error('ä»£ç†å¤±è´¥:', e))
```
**æœŸæœ›ç»“æœ**: çŠ¶æ€ç  200 (å¦‚æœå›¾ç‰‡å­˜åœ¨) æˆ– 404 (å¦‚æœå›¾ç‰‡ä¸å­˜åœ¨ï¼Œä½†è¿æ¥æ­£å¸¸)

### ç¬¬ 3 æ­¥: æµ‹è¯• Markdown ç¼–è¾‘å™¨ä¸Šä¼ 
1. æ‰“å¼€ç¼–è¾‘é¡µé¢
2. ç‚¹å‡»"Markdown ç¼–è¾‘å™¨"æ¨¡å¼
3. åœ¨ç¼–è¾‘å™¨ä¸­æ‹–æ‹½ä¸€å¼ å›¾ç‰‡æˆ–ç‚¹å‡»å·¥å…·æ çš„å›¾ç‰‡æŒ‰é’®ä¸Šä¼ 
4. æŸ¥çœ‹ Console è¾“å‡º:
   - "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ: {url: '/uploads/images/xxx.png'}"
   - "æ’å…¥å›¾ç‰‡URL: /uploads/images/xxx.png"
5. æŸ¥çœ‹å³ä¾§é¢„è§ˆåŒºæ˜¯å¦æ˜¾ç¤ºå›¾ç‰‡

**æœŸæœ›ç»“æœ**: 
- ä¸Šä¼ æˆåŠŸ
- å›¾ç‰‡æ’å…¥åˆ°ç¼–è¾‘å™¨
- é¢„è§ˆåŒºæ˜¾ç¤ºå›¾ç‰‡

### ç¬¬ 4 æ­¥: æµ‹è¯•çŸ¥è¯†å¡ç‰‡æ˜¾ç¤º
1. ä¿å­˜åŒ…å«å›¾ç‰‡çš„çŸ¥è¯†å¡ç‰‡
2. åœ¨çŸ¥è¯†å¡ç‰‡åˆ—è¡¨ä¸­æŸ¥çœ‹
3. ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…

**æœŸæœ›ç»“æœ**: æ‰€æœ‰åœ°æ–¹éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºå›¾ç‰‡

### ç¬¬ 5 æ­¥: æ£€æŸ¥å›¾ç‰‡è¯·æ±‚
åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­:
1. æ‰“å¼€ Network é€‰é¡¹å¡
2. ç­›é€‰ "Img" ç±»å‹
3. åˆ·æ–°é¡µé¢
4. æŸ¥çœ‹æ‰€æœ‰å›¾ç‰‡è¯·æ±‚:
   - URL åº”è¯¥æ˜¯: `http://localhost:5173/uploads/images/xxx.png`
   - çŠ¶æ€ç åº”è¯¥æ˜¯: `200` (æˆåŠŸ)
   - Size åº”è¯¥æ˜¾ç¤ºå›¾ç‰‡å¤§å°

**æœŸæœ›ç»“æœ**: æ‰€æœ‰å›¾ç‰‡è¯·æ±‚è¿”å› 200

---

## ğŸ” è°ƒè¯•ä¿¡æ¯

### Console æ—¥å¿—
ä¿®å¤åçš„ä»£ç ä¼šè¾“å‡ºä»¥ä¸‹è°ƒè¯•ä¿¡æ¯:

#### å›¾ç‰‡å¤„ç†æ—¥å¿— (EditPage.vue)
```javascript
åŸå§‹å›¾ç‰‡URL: /uploads/images/xxx.png
å¤„ç†åå›¾ç‰‡URL: /uploads/images/xxx.png
```

#### å›¾ç‰‡ä¸Šä¼ æ—¥å¿— (MarkdownEditor.vue)
```javascript
å›¾ç‰‡ä¸Šä¼ æˆåŠŸ: {url: '/uploads/images/xxx.png', ...}
æ’å…¥å›¾ç‰‡URL: /uploads/images/xxx.png
```

#### å›¾ç‰‡åŠ è½½å¤±è´¥æ—¥å¿—
```javascript
å›¾ç‰‡åŠ è½½å¤±è´¥: http://localhost:5173/uploads/images/xxx.png
```

### å¸¸è§é—®é¢˜æ’æŸ¥

#### é—®é¢˜ 1: å›¾ç‰‡æ˜¾ç¤º 404
**åŸå› **: 
- å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨
- è·¯å¾„æ ¼å¼é”™è¯¯

**æ£€æŸ¥**:
```powershell
# æŸ¥çœ‹å›¾ç‰‡ç›®å½•
dir "d:\Code\nodejs\Video_Cube\Backend\public\uploads\images"

# æŸ¥çœ‹æ•°æ®åº“ä¸­çš„å›¾ç‰‡è·¯å¾„
```

**è§£å†³**: ç¡®ä¿æ•°æ®åº“ä¸­å­˜å‚¨çš„è·¯å¾„æ ¼å¼æ˜¯ `/uploads/images/xxx.png`

#### é—®é¢˜ 2: å›¾ç‰‡è¯·æ±‚è¢«ä»£ç†åˆ°é”™è¯¯çš„åœ°å€
**åŸå› **: å‰ç«¯æœåŠ¡å™¨æœªé‡å¯

**è§£å†³**:
```powershell
# åœæ­¢æ‰€æœ‰ node è¿›ç¨‹
taskkill /F /IM node.exe

# é‡æ–°å¯åŠ¨å‰ç«¯
cd d:\Code\nodejs\Video_Cube\Frontend
npm exec vite

# é‡æ–°å¯åŠ¨åç«¯
cd d:\Code\nodejs\Video_Cube\Backend
node app.js
```

#### é—®é¢˜ 3: ä¸Šä¼ å¤±è´¥
**åŸå› **: 
- åç«¯æœåŠ¡æœªå¯åŠ¨
- ä¸Šä¼ æ¥å£è·¯å¾„é”™è¯¯

**æ£€æŸ¥ Console**:
```javascript
å›¾ç‰‡ä¸Šä¼ å¤±è´¥: 404 Not Found
é”™è¯¯è¯¦æƒ…: Cannot POST /admin/videos/upload-image
```

**è§£å†³**: ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ 3000 ç«¯å£

#### é—®é¢˜ 4: CORS é”™è¯¯
**åŸå› **: è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢

**è§£å†³**: 
åœ¨ `Backend/app.js` ä¸­ç¡®ä¿æœ‰ CORS é…ç½®:
```javascript
const cors = require('cors');
app.use(cors({
  origin: 'http://localhost:5173',
  credentials: true
}));
```

---

## ğŸ“‹ å®Œæ•´çš„å›¾ç‰‡å¤„ç†æµç¨‹

### ä¸Šä¼ æµç¨‹
```
1. ç”¨æˆ·åœ¨ Markdown ç¼–è¾‘å™¨ä¸­ä¸Šä¼ å›¾ç‰‡
   â†“
2. å‰ç«¯å‘é€ POST /admin/videos/upload-image
   â†“
3. Vite ä»£ç†è½¬å‘åˆ° http://localhost:3000/admin/videos/upload-image
   â†“
4. åç«¯ä¿å­˜å›¾ç‰‡åˆ° Backend/public/uploads/images/xxx.png
   â†“
5. åç«¯è¿”å› { url: '/uploads/images/xxx.png' }
   â†“
6. å‰ç«¯æ’å…¥ Markdown: ![alt](/uploads/images/xxx.png)
```

### æ˜¾ç¤ºæµç¨‹
```
1. Markdown å†…å®¹: ![alt](/uploads/images/xxx.png)
   â†“
2. formatContent() å¤„ç†: <img src="/uploads/images/xxx.png">
   â†“
3. æµè§ˆå™¨è¯·æ±‚: http://localhost:5173/uploads/images/xxx.png
   â†“
4. Vite ä»£ç†è½¬å‘: http://localhost:3000/uploads/images/xxx.png
   â†“
5. Express é™æ€æœåŠ¡: Backend/public/uploads/images/xxx.png
   â†“
6. å›¾ç‰‡æ˜¾ç¤ºæˆåŠŸ âœ…
```

---

## ğŸ¯ å…³é”®æ”¹åŠ¨æ€»ç»“

### ä¿®æ”¹å‰çš„é—®é¢˜
```typescript
// âŒ æ·»åŠ äº†ç»å¯¹ URLï¼Œå¯¼è‡´ä»£ç†å¤±æ•ˆ
const apiBaseUrl = 'http://localhost:3000';
const imageUrl = `${apiBaseUrl}${url}`;
// ç»“æœ: http://localhost:3000/uploads/images/xxx.png
// é—®é¢˜: æµè§ˆå™¨ç›´æ¥è¯·æ±‚åç«¯ï¼Œç»•è¿‡äº† Vite å¼€å‘æœåŠ¡å™¨
```

### ä¿®æ”¹åçš„æ–¹æ¡ˆ
```typescript
// âœ… ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè®© Vite ä»£ç†å¤„ç†
let imageUrl = url; // /uploads/images/xxx.png
// ç»“æœ: /uploads/images/xxx.png
// ä¼˜ç‚¹: Vite ä»£ç†è‡ªåŠ¨è½¬å‘åˆ°åç«¯ï¼Œæ”¯æŒçƒ­æ›´æ–°å’Œå¼€å‘å·¥å…·
```

---

## âœ¨ æ–°å¢åŠŸèƒ½ - Markdown ç¼–è¾‘å™¨

ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ä¸¤ç§ç¼–è¾‘æ¨¡å¼:

### 1. Markdown ç¼–è¾‘å™¨ (æ¨è)
- âœ… å®æ—¶é¢„è§ˆ
- âœ… è¯­æ³•é«˜äº®
- âœ… å·¥å…·æ è¾…åŠ©
- âœ… æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡
- âœ… å¿«æ·é”®æ”¯æŒ

### 2. ç®€å•ç¼–è¾‘å™¨ (åŸå§‹)
- âœ… åŸºç¡€å·¥å…·æ 
- âœ… Markdown è¯­æ³•
- âœ… è½»é‡å¿«é€Ÿ

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœå›¾ç‰‡ä»ç„¶æ— æ³•æ˜¾ç¤ºï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯:

1. **æµè§ˆå™¨ Console çš„é”™è¯¯ä¿¡æ¯**
   - æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
   - æŸ¥çœ‹ Console é€‰é¡¹å¡
   - å¤åˆ¶æ‰€æœ‰çº¢è‰²é”™è¯¯ä¿¡æ¯

2. **Network é€‰é¡¹å¡çš„å›¾ç‰‡è¯·æ±‚è¯¦æƒ…**
   - æ‰“å¼€ Network é€‰é¡¹å¡
   - ç­›é€‰ "Img" ç±»å‹
   - ç‚¹å‡»å¤±è´¥çš„å›¾ç‰‡è¯·æ±‚
   - æŸ¥çœ‹ Headersã€Previewã€Response

3. **åç«¯ Console çš„æ—¥å¿—**
   - æŸ¥çœ‹åç«¯ç»ˆç«¯è¾“å‡º
   - æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

4. **æ•°æ®åº“ä¸­çš„å›¾ç‰‡è·¯å¾„æ ¼å¼**
   - æŸ¥è¯¢ä¸€ä¸ªçŸ¥è¯†å¡ç‰‡è®°å½•
   - æŸ¥çœ‹ content å­—æ®µä¸­çš„å›¾ç‰‡ Markdown

---

## ğŸš€ ä¸‹ä¸€æ­¥

ç°åœ¨å¯ä»¥:
1. âœ… è®¿é—® http://localhost:5173 æµ‹è¯•åŠŸèƒ½
2. âœ… ä½¿ç”¨ Markdown ç¼–è¾‘å™¨åˆ›å»ºçŸ¥è¯†å¡ç‰‡
3. âœ… ä¸Šä¼ å›¾ç‰‡å¹¶æŸ¥çœ‹æ•ˆæœ
4. âœ… åœ¨æ‰€æœ‰ç»„ä»¶ä¸­éªŒè¯å›¾ç‰‡æ˜¾ç¤º

**æ‰€æœ‰ä»£ç ä¿®æ”¹å·²å®Œæˆï¼ŒæœåŠ¡å™¨å·²å¯åŠ¨ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼** ğŸ‰
