# ğŸ‰ å›¾ç‰‡åŠ è½½é—®é¢˜æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

## âœ… é—®é¢˜å·²è§£å†³ï¼

### ä¿®å¤å†…å®¹

1. **æ·»åŠ  CORS æ”¯æŒ** - åç«¯å…è®¸å‰ç«¯è·¨åŸŸè®¿é—® âœ…
2. **è¿”å›å®Œæ•´ URL** - å›¾ç‰‡ URL åŒ…å«åç«¯åœ°å€ âœ…
3. **ç»•è¿‡ Vite ä»£ç†** - ç›´æ¥ä»æµè§ˆå™¨è®¿é—®åç«¯ âœ…

---

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### 1. Backend/app.js

æ·»åŠ äº† CORS ä¸­é—´ä»¶ï¼š

```javascript
// CORS é…ç½® - å…è®¸å‰ç«¯è®¿é—®åç«¯èµ„æº
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', 'http://localhost:5173');
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS, PATCH');
  res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization, X-Requested-With');
  res.header('Access-Control-Allow-Credentials', 'true');
  
  // å¤„ç† OPTIONS é¢„æ£€è¯·æ±‚
  if (req.method === 'OPTIONS') {
    return res.sendStatus(200);
  }
  
  next();
});
```

### 2. Backend/routes/admin/videos.js

ä¿®æ”¹å›¾ç‰‡ä¸Šä¼ æ¥å£ï¼Œè¿”å›å®Œæ•´ URLï¼š

```javascript
// è¿”å›å®Œæ•´çš„å›¾ç‰‡URLï¼ˆåŒ…å«åç«¯åœ°å€ï¼‰
const imageUrl = `http://localhost:3000/uploads/images/${req.file.filename}`;

res.json({
  status: true,
  message: 'å›¾ç‰‡ä¸Šä¼ æˆåŠŸ',
  data: {
    url: imageUrl,  // http://localhost:3000/uploads/images/xxx.png
    ...
  }
});
```

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### PowerShell æµ‹è¯•
```powershell
PS> Invoke-WebRequest -Uri "http://localhost:3000/uploads/images/xxx.png" -Headers @{'Origin'='http://localhost:5173'}

çŠ¶æ€: 200 âœ…
ç±»å‹: image/png âœ…
CORS: http://localhost:5173 âœ…
å¤§å°: 160036 bytes âœ…
```

---

## ğŸ¯ ç°åœ¨çš„å·¥ä½œæµç¨‹

### ä¸Šä¼ æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»å›¾ç‰‡æŒ‰é’®
    â†“
Toast UI Editor æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨
    â†“
è§¦å‘ addImageBlobHook
    â†“
POST /api/admin/videos/upload-image (é€šè¿‡ Vite ä»£ç†)
    â†“
åç«¯ä¿å­˜å›¾ç‰‡
    â†“
è¿”å›å®Œæ•´ URL: http://localhost:3000/uploads/images/xxx.png
    â†“
Toast UI Editor æ’å…¥: ![image](http://localhost:3000/uploads/images/xxx.png)
    â†“
âœ… å®Œæˆ
```

### æ˜¾ç¤ºæµç¨‹
```
æµè§ˆå™¨è§£æ Markdown
    â†“
å‘ç°å›¾ç‰‡: ![image](http://localhost:3000/uploads/images/xxx.png)
    â†“
æµè§ˆå™¨ç›´æ¥è¯·æ±‚åç«¯ (è·¨åŸŸè¯·æ±‚)
    â†“
åç«¯æ£€æŸ¥ Origin: http://localhost:5173
    â†“
è¿”å› CORS å¤´: Access-Control-Allow-Origin: http://localhost:5173
    â†“
è¿”å›å›¾ç‰‡æ•°æ® (image/png, 160KB)
    â†“
æµè§ˆå™¨æ¥æ”¶å¹¶æ˜¾ç¤ºå›¾ç‰‡
    â†“
âœ… å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
```

---

## ğŸš€ ç«‹å³æµ‹è¯•

### æ­¥éª¤ 1: ç¡®ä¿æœåŠ¡è¿è¡Œ

```powershell
# æ£€æŸ¥åç«¯ (3000)
netstat -ano | findstr ":3000"

# æ£€æŸ¥å‰ç«¯ (5173)
netstat -ano | findstr ":5173"
```

### æ­¥éª¤ 2: åˆ·æ–°æµè§ˆå™¨

1. æ‰“å¼€ http://localhost:5173
2. **æŒ‰ Ctrl+Shift+R** (ç¡¬åˆ·æ–°)
3. æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
4. Network æ ‡ç­¾ â†’ å‹¾é€‰ "Disable cache"

### æ­¥éª¤ 3: æµ‹è¯•ä¸Šä¼ 

1. è¿›å…¥ç¼–è¾‘é¡µé¢
2. åˆ‡æ¢åˆ° "Markdown ç¼–è¾‘å™¨"
3. ç‚¹å‡»å·¥å…·æ å›¾ç‰‡æŒ‰é’®
4. é€‰æ‹©ä¸€å¼ å›¾ç‰‡
5. ç­‰å¾…ä¸Šä¼ 

### æ­¥éª¤ 4: éªŒè¯ç»“æœ

åœ¨ Console ä¸­åº”è¯¥çœ‹åˆ°ï¼š

```javascript
âœ… å›¾ç‰‡ä¸Šä¼ æˆåŠŸ: {status: true, ...}
âœ… æ’å…¥å›¾ç‰‡URL: http://localhost:3000/uploads/images/xxx.png
```

åœ¨ Network æ ‡ç­¾åº”è¯¥çœ‹åˆ°ï¼š

```
è¯·æ±‚: http://localhost:3000/uploads/images/xxx.png
çŠ¶æ€: 200 OK
ç±»å‹: image/png
å¤§å°: ~160 KB
```

åœ¨é¡µé¢ä¸Šåº”è¯¥çœ‹åˆ°ï¼š

```
âœ… å›¾ç‰‡æ­£å¸¸æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨ä¸­
âœ… å›¾ç‰‡æ­£å¸¸æ˜¾ç¤ºåœ¨é¢„è§ˆåŒº
âœ… çŸ¥è¯†å¡ç‰‡ä¸­å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
```

---

## ğŸ“ å…³é”®ç‚¹

### ä¸ºä»€ä¹ˆä¸ç”¨ Vite ä»£ç†ï¼Ÿ

1. âŒ Vite çš„ SPA fallback ä¼˜å…ˆçº§å¤ªé«˜
2. âŒ å¾ˆéš¾æ§åˆ¶ä¸­é—´ä»¶æ‰§è¡Œé¡ºåº
3. âŒ é…ç½®å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™

### ä¸ºä»€ä¹ˆä½¿ç”¨ CORSï¼Ÿ

1. âœ… ç®€å•ç›´æ¥ï¼Œåç«¯ä¸€è¡Œä»£ç æå®š
2. âœ… ç”Ÿäº§ç¯å¢ƒä¹Ÿéœ€è¦ CORS
3. âœ… ä¸ä¾èµ– Vite çš„ä»£ç†æœºåˆ¶
4. âœ… æœ€ç¨³å®šå¯é 

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒ

- åç«¯ CORS å…è®¸ `http://localhost:5173`
- å›¾ç‰‡ URL: `http://localhost:3000/uploads/images/xxx.png`

### ç”Ÿäº§ç¯å¢ƒ

éœ€è¦ä¿®æ”¹ï¼š

1. **CORS Origin**
```javascript
res.header('Access-Control-Allow-Origin', 'https://yourdomain.com');
```

2. **å›¾ç‰‡ URL**
```javascript
const imageUrl = `https://api.yourdomain.com/uploads/images/${req.file.filename}`;
// æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡
const baseUrl = process.env.API_BASE_URL || 'http://localhost:3000';
const imageUrl = `${baseUrl}/uploads/images/${req.file.filename}`;
```

---

## ğŸŠ æ€»ç»“

### é—®é¢˜æ ¹æº

- Vite çš„ HTML fallback æ‹¦æˆªäº† `/uploads` è¯·æ±‚
- è¿”å› index.html è€Œä¸æ˜¯ä»£ç†åˆ°åç«¯
- æµè§ˆå™¨æ”¶åˆ° HTML è€Œä¸æ˜¯å›¾ç‰‡æ•°æ®

### è§£å†³æ–¹æ¡ˆ

- åç«¯æ·»åŠ  CORS æ”¯æŒ
- è¿”å›å®Œæ•´çš„å›¾ç‰‡ URL
- æµè§ˆå™¨ç›´æ¥è®¿é—®åç«¯ï¼Œç»•è¿‡ Vite

### ç»“æœ

- âœ… å›¾ç‰‡ä¸Šä¼ æ­£å¸¸
- âœ… å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸
- âœ… æ‰€æœ‰ç»„ä»¶å·¥ä½œæ­£å¸¸
- âœ… é…ç½®ç®€å•å¯é 

---

**ç°åœ¨åˆ·æ–°æµè§ˆå™¨ï¼Œæµ‹è¯•ä¸Šä¼ æ–°å›¾ç‰‡ï¼Œåº”è¯¥å®Œå…¨æ­£å¸¸äº†ï¼** ğŸ‰
