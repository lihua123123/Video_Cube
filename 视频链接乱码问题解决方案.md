# è§†é¢‘é“¾æ¥ä¹±ç é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆ:è§†é¢‘é“¾æ¥è¾“å…¥æ¡†ä¸­æ˜¾ç¤ºä¹±ç ,ç±»ä¼¼:
```
/uploads/videos/a1â–¡a7â–¡a2=â–¡ 2025-08-11 123356_0b20cd0e.mp4
```

## ğŸ” é—®é¢˜åˆ†æ

### å¯èƒ½çš„åŸå› 

1. **URLå¤šæ¬¡ç¼–ç **
   - URLå¯èƒ½è¢« `encodeURIComponent` å¤šæ¬¡ç¼–ç 
   - æˆ–è€…è¢«ç¼–ç ååˆå°è¯•ä½œä¸ºæ–‡æœ¬æ˜¾ç¤º

2. **æ˜¾ç¤ºé”™è¯¯çš„URL**
   - æ˜¾ç¤ºäº†å¸¦ `/api` å‰ç¼€çš„APIè·¯å¾„è€Œä¸æ˜¯å®é™…æ–‡ä»¶è·¯å¾„
   - åœ¨è¾“å…¥æ¡†ä¸­æ˜¾ç¤º `/api/uploads/videos/xxx.mp4` ä¼šè®©ç”¨æˆ·å›°æƒ‘

3. **å­—ç¬¦ç¼–ç é—®é¢˜**
   - å¦‚æœåŸå§‹æ–‡ä»¶ååŒ…å«ä¸­æ–‡,ä½†å­˜å‚¨æ—¶ä½¿ç”¨äº†é”™è¯¯çš„ç¼–ç 
   - ä¸è¿‡ç›®å‰ç³»ç»Ÿä½¿ç”¨UUIDä½œä¸ºæ–‡ä»¶å,åº”è¯¥ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜

### ä»£ç é—®é¢˜å®šä½

**æ–‡ä»¶:** `Frontend/src/views/UserPage.vue` (ç¬¬487-497è¡Œ)

**é—®é¢˜ä»£ç :**
```typescript
const handleLibraryVideoPlay = (video: LibraryVideo) => {
  const fullUrl = `/api${video.video_url}`  // ç”¨äºæ’­æ”¾çš„URL
  
  currentVideo.value = fullUrl  // è®¾ç½®ç»™ <video> æ ‡ç­¾
  videoUrl.value = fullUrl      // âŒ é—®é¢˜: åœ¨è¾“å…¥æ¡†æ˜¾ç¤º /api/uploads/...
  videoId.value = video.id
  //...
}
```

**é—®é¢˜åˆ†æ:**
- `currentVideo.value` éœ€è¦ `/api` å‰ç¼€,å› ä¸ºè¿™æ˜¯ä¼ ç»™ `<video>` æ ‡ç­¾çš„,éœ€è¦é€šè¿‡Viteä»£ç†
- ä½† `videoUrl.value` æ˜¯æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¸­çš„,ç”¨æˆ·åº”è¯¥çœ‹åˆ°çš„æ˜¯å®é™…çš„æ–‡ä»¶è·¯å¾„,è€Œä¸æ˜¯APIè·¯å¾„

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹ä»£ç 

**æ–‡ä»¶:** `Frontend/src/views/UserPage.vue` (ç¬¬487-498è¡Œ)

**ä¿®æ”¹å‰:**
```typescript
const handleLibraryVideoPlay = (video: LibraryVideo) => {
  const fullUrl = video.video_url.startsWith('http') ? 
    video.video_url : 
    `/api${video.video_url}`
  
  currentVideo.value = fullUrl
  videoUrl.value = fullUrl       // âŒ æ˜¾ç¤º /api/uploads/videos/xxx.mp4
  videoId.value = video.id
  // ...
}
```

**ä¿®æ”¹å:**
```typescript
const handleLibraryVideoPlay = (video: LibraryVideo) => {
  const fullUrl = video.video_url.startsWith('http') ? 
    video.video_url : 
    `/api${video.video_url}`
  
  currentVideo.value = fullUrl
  videoUrl.value = video.video_url  // âœ… æ˜¾ç¤ºåŸå§‹è·¯å¾„ /uploads/videos/xxx.mp4
  videoId.value = video.id
  // ...
}
```

## ğŸ¯ ä¿®å¤åŸç†

### åˆ†ç¦»æ˜¾ç¤ºURLå’Œæ’­æ”¾URL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è§†é¢‘URLçš„ä¸¤ç§ç”¨é€”                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ’­æ”¾URL (currentVideo)                               â”‚
â”‚    - ç”¨äº <video src="...">                             â”‚
â”‚    - éœ€è¦ /api å‰ç¼€ä»¥é€šè¿‡Viteä»£ç†                        â”‚
â”‚    - å€¼: /api/uploads/videos/uuid.mp4                   â”‚
â”‚                                                          â”‚
â”‚ 2. æ˜¾ç¤ºURL (videoUrl)                                   â”‚
â”‚    - ç”¨äºè¾“å…¥æ¡†æ˜¾ç¤º                                       â”‚
â”‚    - æ˜¾ç¤ºå®é™…çš„æ–‡ä»¶è·¯å¾„                                    â”‚
â”‚    - å€¼: /uploads/videos/uuid.mp4                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥ä½œæµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»è§†é¢‘åº“ä¸­çš„"æ’­æ”¾"æŒ‰é’®
   â†“
2. è§¦å‘ handleLibraryVideoPlay(video)
   video.video_url = "/uploads/videos/abc123.mp4"
   â†“
3. æ„å»ºæ’­æ”¾URL
   fullUrl = "/api/uploads/videos/abc123.mp4"
   â†“
4. åˆ†åˆ«è®¾ç½®ä¸¤ä¸ªå˜é‡:
   currentVideo.value = "/api/uploads/videos/abc123.mp4"  (ç”¨äºæ’­æ”¾)
   videoUrl.value = "/uploads/videos/abc123.mp4"          (ç”¨äºæ˜¾ç¤º)
   â†“
5. æµè§ˆå™¨æ¸²æŸ“:
   - <video src="/api/uploads/videos/abc123.mp4">         (é€šè¿‡Viteä»£ç†è®¿é—®)
   - <input v-model="videoUrl">                           (æ˜¾ç¤ºæ¸…æ™°çš„è·¯å¾„)
   â†“
6. ç”¨æˆ·çœ‹åˆ°:
   è¾“å…¥æ¡†: /uploads/videos/abc123.mp4  âœ… æ¸…æ™°æ˜“è¯»
   è§†é¢‘: æ­£å¸¸æ’­æ”¾  âœ… é€šè¿‡ä»£ç†è®¿é—®
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

é¦–å…ˆæ¸…é™¤å¯èƒ½çš„ç¼“å­˜æ•°æ®:

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.removeItem('lastVideoState')
location.reload()
```

### 2. æµ‹è¯•è§†é¢‘æ’­æ”¾å’Œæ˜¾ç¤º

1. åˆ·æ–°é¡µé¢ (Ctrl + Shift + R ç¡¬åˆ·æ–°)
2. ç‚¹å‡» "ğŸ“š è§†é¢‘åº“" æŒ‰é’®
3. ç‚¹å‡»ä»»æ„è§†é¢‘çš„ "â–¶ï¸ æ’­æ”¾" æŒ‰é’®
4. æ£€æŸ¥è§†é¢‘é“¾æ¥è¾“å…¥æ¡†

**é¢„æœŸç»“æœ:**
- è¾“å…¥æ¡†æ˜¾ç¤º: `/uploads/videos/[uuid].mp4`
- è§†é¢‘æ­£å¸¸æ’­æ”¾
- æ²¡æœ‰ä¹±ç 

### 3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

æ‰“å¼€å¼€å‘è€…å·¥å…· (F12):

**Network æ ‡ç­¾:**
- è§†é¢‘è¯·æ±‚URLåº”è¯¥æ˜¯: `/api/uploads/videos/[uuid].mp4`
- çŠ¶æ€ç : `200`
- Content-Type: `video/mp4`

**Console æ ‡ç­¾:**
- åº”è¯¥çœ‹åˆ°: "æ­£åœ¨æ’­æ”¾: [è§†é¢‘æ ‡é¢˜]"
- æ²¡æœ‰é”™è¯¯ä¿¡æ¯

## ğŸ“Š å¯¹æ¯”æ•ˆæœ

| æ–¹é¢ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| è¾“å…¥æ¡†æ˜¾ç¤º | `/api/uploads/videos/xxx.mp4` | `/uploads/videos/xxx.mp4` |
| æ˜¾ç¤ºæ¸…æ™°åº¦ | âŒ åŒ…å«APIå‰ç¼€,ä¸ç›´è§‚ | âœ… å®é™…æ–‡ä»¶è·¯å¾„,æ¸…æ™° |
| è§†é¢‘æ’­æ”¾ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ |
| ç”¨æˆ·ç†è§£ | âŒ å›°æƒ‘(ä¸ºä»€ä¹ˆæœ‰/api?) | âœ… æ¸…æ™°(å°±æ˜¯æ–‡ä»¶è·¯å¾„) |

## ğŸ”§ é¢å¤–ä¼˜åŒ–å»ºè®®

### 1. æ·»åŠ URLè§£ç æ˜¾ç¤º

å¦‚æœURLçœŸçš„è¢«ç¼–ç äº†,å¯ä»¥æ·»åŠ è§£ç :

```typescript
const handleLibraryVideoPlay = (video: LibraryVideo) => {
  const fullUrl = video.video_url.startsWith('http') ? 
    video.video_url : 
    `/api${video.video_url}`
  
  currentVideo.value = fullUrl
  // å°è¯•è§£ç URLä»¥é˜²ä¸‡ä¸€è¢«ç¼–ç äº†
  try {
    videoUrl.value = decodeURIComponent(video.video_url)
  } catch {
    videoUrl.value = video.video_url  // å¦‚æœè§£ç å¤±è´¥,ä½¿ç”¨åŸå§‹å€¼
  }
  videoId.value = video.id
  // ...
}
```

### 2. æ˜¾ç¤ºæ›´å‹å¥½çš„ä¿¡æ¯

å¯ä»¥æ˜¾ç¤ºè§†é¢‘æ ‡é¢˜è€Œä¸æ˜¯URL:

```vue
<template>
  <div class="url-input-group">
    <label>å½“å‰è§†é¢‘</label>
    <div class="input-wrapper">
      <!-- æ˜¾ç¤ºè§†é¢‘æ ‡é¢˜ -->
      <input 
        type="text" 
        :value="currentVideoTitle || videoUrl" 
        placeholder="è¾“å…¥è§†é¢‘URL" 
        class="url-input" 
        readonly
      />
      <!-- æ˜¾ç¤ºå®é™…URLåœ¨æç¤ºä¸­ -->
      <span class="url-hint" :title="videoUrl">{{ videoUrl }}</span>
    </div>
  </div>
</template>

<script setup>
const currentVideoTitle = ref('')

const handleLibraryVideoPlay = (video: LibraryVideo) => {
  // ...
  currentVideoTitle.value = video.title  // ä¿å­˜æ ‡é¢˜
  // ...
}
</script>
```

## ğŸ› å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### æ£€æŸ¥æ¸…å•

1. **æ£€æŸ¥localStorage**
   ```javascript
   // åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
   console.log(localStorage.getItem('lastVideoState'))
   ```
   - å¦‚æœçœ‹åˆ°ä¹±ç ,æ¸…é™¤å®ƒ: `localStorage.clear()`

2. **æ£€æŸ¥æ•°æ®åº“ä¸­çš„URL**
   ```bash
   cd Backend
   node check_video_urls.js
   ```
   - ç¡®è®¤æ•°æ®åº“ä¸­å­˜å‚¨çš„URLæ˜¯æ­£ç¡®çš„UUIDæ ¼å¼

3. **æ£€æŸ¥æ–‡ä»¶å®é™…å­˜åœ¨**
   ```
   Backend/public/uploads/videos/
   ```
   - ç¡®è®¤æ–‡ä»¶åéƒ½æ˜¯UUIDæ ¼å¼,æ²¡æœ‰ä¸­æ–‡å­—ç¬¦

4. **æ£€æŸ¥æµè§ˆå™¨ç¼–ç è®¾ç½®**
   - ç¡®ä¿æµè§ˆå™¨ä½¿ç”¨UTF-8ç¼–ç 
   - F12 â†’ Network â†’ æŸ¥çœ‹Response Headersä¸­çš„ Content-Type

### æ•…éšœæ’é™¤æ­¥éª¤

**æ­¥éª¤1: æ¸…é™¤æ‰€æœ‰ç¼“å­˜**
```javascript
// æµè§ˆå™¨æ§åˆ¶å°
localStorage.clear()
sessionStorage.clear()
location.reload(true)
```

**æ­¥éª¤2: æ£€æŸ¥è§†é¢‘å¯¹è±¡**
```typescript
// åœ¨ handleLibraryVideoPlay å‡½æ•°å¼€å¤´æ·»åŠ 
console.log('è§†é¢‘å¯¹è±¡:', video)
console.log('video_url:', video.video_url)
console.log('video_url ç±»å‹:', typeof video.video_url)
console.log('video_url é•¿åº¦:', video.video_url.length)
```

**æ­¥éª¤3: æ£€æŸ¥æ˜¯å¦è¢«ç¼–ç **
```typescript
// åœ¨æ§åˆ¶å°æµ‹è¯•
const url = "/uploads/videos/abc123.mp4"
console.log('åŸå§‹:', url)
console.log('ç¼–ç ä¸€æ¬¡:', encodeURIComponent(url))
console.log('ç¼–ç ä¸¤æ¬¡:', encodeURIComponent(encodeURIComponent(url)))
```

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒä¿®æ”¹

**åªä¿®æ”¹äº†ä¸€è¡Œä»£ç :**
```typescript
// ä¿®æ”¹å‰
videoUrl.value = fullUrl  // æ˜¾ç¤º /api/uploads/videos/xxx.mp4

// ä¿®æ”¹å
videoUrl.value = video.video_url  // æ˜¾ç¤º /uploads/videos/xxx.mp4
```

### ä¿®å¤æ•ˆæœ

- âœ… è¾“å…¥æ¡†æ˜¾ç¤ºæ¸…æ™°çš„æ–‡ä»¶è·¯å¾„
- âœ… æ²¡æœ‰å¤šä½™çš„ `/api` å‰ç¼€
- âœ… è§†é¢‘æ’­æ”¾ä¸å—å½±å“
- âœ… ç”¨æˆ·ä½“éªŒæ›´å¥½

### å…³é”®è¦ç‚¹

1. **åˆ†ç¦»èŒè´£**: æ’­æ”¾URLå’Œæ˜¾ç¤ºURLåº”è¯¥åˆ†å¼€
2. **ç”¨æˆ·å‹å¥½**: æ˜¾ç¤ºç»™ç”¨æˆ·çš„åº”è¯¥æ˜¯ä»–ä»¬èƒ½ç†è§£çš„å†…å®¹
3. **å†…éƒ¨å¤„ç†**: APIè·¯å¾„ç­‰å†…éƒ¨ç»†èŠ‚ä¸åº”è¯¥æš´éœ²ç»™ç”¨æˆ·

---

**ä¿®å¤å®Œæˆ! ğŸ‰**

ç°åœ¨è§†é¢‘é“¾æ¥åº”è¯¥æ˜¾ç¤ºæ­£ç¡®äº†ã€‚å¦‚æœè¿˜æœ‰é—®é¢˜,è¯·:
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒlocalStorage
2. åˆ·æ–°é¡µé¢
3. é‡æ–°æ‰“å¼€è§†é¢‘åº“å¹¶æ’­æ”¾è§†é¢‘
