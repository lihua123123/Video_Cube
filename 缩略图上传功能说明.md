# 缩略图上传功能说明

## ✨ 功能概述

为视频库添加了手动上传缩略图的功能,解决自动生成缩略图无法正常显示的问题。

## 📍 使用方法

### 1. 打开视频详情
- 在视频库中点击任意视频的 **"ℹ️"详情按钮**
- 详情模态框会弹出

### 2. 上传缩略图
在详情模态框中找到 **"缩略图管理"** 部分:

1. **查看当前缩略图**
   - 如果有缩略图,会显示预览图
   - 如果没有缩略图,会显示"暂无缩略图"占位符

2. **选择新缩略图**
   - 点击 **"📁 选择图片"** 按钮
   - 在文件选择器中选择图片文件
   - 支持的格式: JPG, PNG, GIF, WebP
   - 文件大小限制: 最大 2MB

3. **预览新缩略图**
   - 选择文件后,会立即显示预览
   - 可以确认是否是想要的图片

4. **上传缩略图**
   - 确认预览无误后,点击 **"⬆️ 上传缩略图"** 按钮
   - 上传过程中按钮会显示 "上传中..."
   - 上传成功后会自动刷新视频列表

5. **取消选择**
   - 如果选错了图片,点击 **"✕ 取消"** 按钮
   - 清除已选择的文件,重新选择

## 🎯 功能特点

### 前端功能
- ✅ 文件格式验证 (JPG, PNG, GIF, WebP)
- ✅ 文件大小验证 (最大 2MB)
- ✅ 实时预览选中的图片
- ✅ 上传进度提示
- ✅ 自动刷新视频列表
- ✅ 友好的用户提示

### 后端功能
- ✅ 安全的文件上传 (使用 multer)
- ✅ 唯一文件名生成 (UUID)
- ✅ 文件类型验证
- ✅ 文件大小限制
- ✅ 自动创建上传目录
- ✅ 数据库记录更新

## 📂 文件位置

缩略图会被保存在:
```
Backend/public/uploads/thumbnails/
```

访问路径:
```
/uploads/thumbnails/{文件名}
```

## 🔧 技术实现

### 前端修改
- **文件**: `Frontend/src/components/VideoLibrary.vue`
- **新增功能**:
  - 文件选择器
  - 图片预览
  - 上传进度提示
  - 状态管理

### 后端修改
- **文件**: `Backend/routes/admin/videos.js`
  - 修改 `POST /api/admin/videos/:id/thumbnail` 端点
  - 支持文件上传和自动生成两种方式

- **文件**: `Backend/utils/upload-service.js`
  - 新增 `createThumbnailUploadMiddleware()` 方法
  - 新增缩略图文件验证逻辑

## 💡 使用建议

1. **图片尺寸**: 建议使用 16:9 比例的图片 (如 1280×720, 1920×1080)
2. **文件大小**: 控制在 500KB 以内以获得更好的加载速度
3. **图片格式**: 推荐使用 JPG 格式,压缩比更好
4. **图片质量**: 建议使用清晰的视频截图作为缩略图

## 🐛 故障排除

### 上传失败
- 检查文件格式是否正确
- 检查文件大小是否超过 2MB
- 检查后端服务器是否正常运行
- 检查 `Backend/public/uploads/thumbnails/` 目录是否存在

### 缩略图不显示
- 清除浏览器缓存
- 刷新视频列表
- 检查文件路径是否正确
- 检查浏览器控制台是否有错误信息

## 📝 API 接口

### 上传缩略图
```
POST /api/admin/videos/:id/thumbnail
Content-Type: multipart/form-data

Body:
- thumbnail: File (图片文件)

Response:
{
  "status": true,
  "message": "缩略图上传成功",
  "data": {
    "video": { ... },
    "thumbnail_url": "/uploads/thumbnails/xxx.jpg"
  }
}
```

## ✅ 测试建议

1. 测试不同格式的图片 (JPG, PNG, GIF, WebP)
2. 测试文件大小限制 (上传超过 2MB 的文件)
3. 测试文件格式验证 (上传非图片文件)
4. 测试上传后的显示效果
5. 测试多次更换缩略图

---

**开发时间**: 2025-11-24
**版本**: v1.0
