# çŸ¥è¯†å¡ç‰‡å›¾ç‰‡æ˜¾ç¤º - æœ€ç»ˆä¿®å¤æ–¹æ¡ˆ

## âœ… é—®é¢˜å·²å½»åº•è§£å†³ï¼

### å‘ç°çš„æ‰€æœ‰é—®é¢˜

#### é—®é¢˜ 1: æ•°æ®ç»“æ„è®¿é—®é”™è¯¯ âœ…
**é”™è¯¯**: è®¿é—® `data.url` è€Œä¸æ˜¯ `data.data.url`  
**å·²ä¿®å¤**: MarkdownEditor.vue ç¬¬ 60-68 è¡Œ

#### é—®é¢˜ 2: Vite ä»£ç†ä¸¢å¤± Content-Type boundary âœ…
**é”™è¯¯**: 
```
Error: Multipart: Boundary not found
```
**åŸå› **: Vite ä»£ç†è½¬å‘ multipart/form-data è¯·æ±‚æ—¶ï¼Œä¸¢å¤±äº† boundary å‚æ•°

**å·²ä¿®å¤**: vite.config.ts æ·»åŠ äº† `configure` é’©å­ä¿ç•™åŸå§‹è¯·æ±‚å¤´

#### é—®é¢˜ 3: å¤šä¸ªæœåŠ¡å™¨å®ä¾‹å†²çª âœ…
**é”™è¯¯**: æµè§ˆå™¨è®¿é—®ç«¯å£ 5173ï¼Œä½†æœåŠ¡å™¨è¿è¡Œåœ¨ 5174  
**å·²ä¿®å¤**: åœæ­¢æ‰€æœ‰æ—§è¿›ç¨‹ï¼Œç»Ÿä¸€ä½¿ç”¨ç«¯å£ 5173

---

## ğŸ”§ æœ€ç»ˆé…ç½®

### 1. Vite é…ç½® (vite.config.ts)
```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, ''),
      configure: (proxy, options) => {
        proxy.on('proxyReq', (proxyReq, req, res) => {
          // ä¿ç•™åŸå§‹çš„ Content-Type å¤´ï¼Œç‰¹åˆ«æ˜¯ multipart/form-data çš„ boundary
          if (req.headers['content-type']) {
            proxyReq.setHeader('Content-Type', req.headers['content-type']);
          }
        });
      }
    },
    '/uploads': {
      target: 'http://localhost:3000',
      changeOrigin: true,
      secure: false
    }
  }
}
```

**å…³é”®ç‚¹**: 
- âœ… `/api` å‰ç¼€é€šè¿‡ `rewrite` å»æ‰
- âœ… `configure` é’©å­ä¿ç•™ multipart boundary
- âœ… `/uploads` ç›´æ¥ä»£ç†åˆ°åç«¯

### 2. Markdown ç¼–è¾‘å™¨ (MarkdownEditor.vue)
```typescript
if (response.ok) {
  const result = await response.json()
  console.log('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ:', result)
  
  // åç«¯è¿”å›æ ¼å¼: { status, message, data: { url, filename, ... } }
  if (result.status && result.data && result.data.url) {
    const imageUrl = result.data.url // /uploads/images/xxx.png
    const fileName = (blob as File).name || result.data.filename || 'image'
    console.log('æ’å…¥å›¾ç‰‡URL:', imageUrl)
    callback(imageUrl, fileName)
  } else {
    console.error('å›¾ç‰‡ä¸Šä¼ å“åº”æ ¼å¼é”™è¯¯:', result)
    alert('å›¾ç‰‡ä¸Šä¼ å¤±è´¥: å“åº”æ ¼å¼é”™è¯¯')
  }
}
```

**å…³é”®ç‚¹**:
- âœ… æ­£ç¡®è®¿é—® `result.data.url`
- âœ… æ·»åŠ æ•°æ®éªŒè¯
- âœ… æ”¹è¿›é”™è¯¯å¤„ç†

### 3. å›¾ç‰‡è·¯å¾„å¤„ç† (æ‰€æœ‰ç»„ä»¶ç»Ÿä¸€)
```typescript
// EditPage.vue, KnowledgeCardDisplay.vue, KnowledgeCardPopup.vue, KnowledgeCardModal.vue
let imageUrl = url;
if (!url.startsWith('http') && !url.startsWith('/')) {
  imageUrl = '/' + url;
}
```

**å…³é”®ç‚¹**:
- âœ… ç›¸å¯¹è·¯å¾„ç»Ÿä¸€æ·»åŠ  `/` å‰ç¼€
- âœ… ç»å¯¹ URL ä¿æŒä¸å˜
- âœ… è®© Vite ä»£ç†è‡ªåŠ¨å¤„ç†

---

## ğŸ“Š å®Œæ•´çš„è¯·æ±‚æµç¨‹

### å›¾ç‰‡ä¸Šä¼ æµç¨‹
```
ç”¨æˆ·æ‹–æ‹½å›¾ç‰‡åˆ° Markdown ç¼–è¾‘å™¨
    â†“
Toast UI Editor è§¦å‘ addImageBlobHook(blob)
    â†“
FormData.append('image', blob)
    â†“
fetch('/api/admin/videos/upload-image', { method: 'POST', body: formData })
    â†“
Vite ä»£ç†æ‹¦æˆª /api è¯·æ±‚
    â†“
configure é’©å­ä¿ç•™ Content-Type: multipart/form-data; boundary=...
    â†“
rewrite å»æ‰ /api å‰ç¼€: /admin/videos/upload-image
    â†“
è½¬å‘åˆ° http://localhost:3000/admin/videos/upload-image
    â†“
Express + Multer å¤„ç†ä¸Šä¼ 
    â†“
ä¿å­˜åˆ° Backend/public/uploads/images/{uuid}.png
    â†“
è¿”å› JSON:
{
  status: true,
  message: 'å›¾ç‰‡ä¸Šä¼ æˆåŠŸ',
  data: {
    url: '/uploads/images/{uuid}.png',
    filename: '{uuid}.png',
    originalName: 'xxx.png',
    size: 12345,
    mimetype: 'image/png'
  }
}
    â†“
å‰ç«¯æå– result.data.url
    â†“
Toast UI Editor æ’å…¥: ![alt](/uploads/images/{uuid}.png)
    â†“
âœ… ä¸Šä¼ æˆåŠŸ
```

### å›¾ç‰‡æ˜¾ç¤ºæµç¨‹
```
Markdown: ![alt](/uploads/images/{uuid}.png)
    â†“
formatContent() å¤„ç†: <img src="/uploads/images/{uuid}.png">
    â†“
æµè§ˆå™¨è¯·æ±‚: http://localhost:5173/uploads/images/{uuid}.png
    â†“
Vite /uploads ä»£ç†æ‹¦æˆª
    â†“
è½¬å‘åˆ° http://localhost:3000/uploads/images/{uuid}.png
    â†“
Express é™æ€æœåŠ¡: Backend/public/uploads/images/{uuid}.png
    â†“
è¿”å›å›¾ç‰‡æ–‡ä»¶
    â†“
âœ… å›¾ç‰‡æ˜¾ç¤ºæˆåŠŸ
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### ç¬¬ 1 æ­¥: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
**é‡è¦**: æŒ‰ Ctrl+Shift+Delete æ¸…é™¤ç¼“å­˜ï¼Œæˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼

### ç¬¬ 2 æ­¥: è®¿é—®åº”ç”¨
```
http://localhost:5173
```

### ç¬¬ 3 æ­¥: ä¸Šä¼ å›¾ç‰‡æµ‹è¯•
1. è¿›å…¥ç¼–è¾‘é¡µé¢
2. åˆ‡æ¢åˆ° "Markdown ç¼–è¾‘å™¨" æ¨¡å¼
3. æ‹–æ‹½å›¾ç‰‡æˆ–ç‚¹å‡»å·¥å…·æ å›¾ç‰‡æŒ‰é’®
4. æŸ¥çœ‹ Console è¾“å‡º

**æœŸæœ›çš„æˆåŠŸæ—¥å¿—**:
```javascript
å›¾ç‰‡ä¸Šä¼ æˆåŠŸ: {status: true, message: "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ", data: {â€¦}}
æ’å…¥å›¾ç‰‡URL: /uploads/images/0b3e6e8c-cdc2-491e-9bcd-da5d4cf79068.png
åŸå§‹å›¾ç‰‡URL: /uploads/images/0b3e6e8c-cdc2-491e-9bcd-da5d4cf79068.png
å¤„ç†åå›¾ç‰‡URL: /uploads/images/0b3e6e8c-cdc2-491e-9bcd-da5d4cf79068.png
```

**æœŸæœ›çš„ Network æ ‡ç­¾**:
```
Request URL: http://localhost:5173/api/admin/videos/upload-image
Status: 200 OK
Response: {"status":true,"message":"å›¾ç‰‡ä¸Šä¼ æˆåŠŸ","data":{...}}
```

### ç¬¬ 4 æ­¥: éªŒè¯å›¾ç‰‡æ˜¾ç¤º
1. å›¾ç‰‡åº”è¯¥åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤º
2. å›¾ç‰‡åº”è¯¥åœ¨å³ä¾§é¢„è§ˆåŒºæ˜¾ç¤º
3. ä¿å­˜ååœ¨çŸ¥è¯†å¡ç‰‡åˆ—è¡¨ä¸­æ˜¾ç¤º
4. ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…æ—¶æ˜¾ç¤º

---

## ğŸ¯ éªŒè¯æ¸…å•

- [x] Vite ä»£ç†é…ç½®æ­£ç¡® (rewrite + configure)
- [x] MarkdownEditor.vue æ•°æ®è®¿é—®æ­£ç¡® (result.data.url)
- [x] æ‰€æœ‰ç»„ä»¶å›¾ç‰‡è·¯å¾„å¤„ç†ç»Ÿä¸€
- [x] åç«¯æœåŠ¡è¿è¡Œåœ¨ 3000 ç«¯å£
- [x] å‰ç«¯æœåŠ¡è¿è¡Œåœ¨ 5173 ç«¯å£
- [x] æ²¡æœ‰æ—§çš„æœåŠ¡å™¨å®ä¾‹å†²çª
- [x] multipart boundary æ­£ç¡®ä¼ é€’
- [x] å›¾ç‰‡æ–‡ä»¶å®é™…å­˜åœ¨äºç£ç›˜

---

## ğŸ“ å…³é”®æ–‡ä»¶ä¿®æ”¹æ€»ç»“

### ä¿®æ”¹çš„æ–‡ä»¶
1. âœ… `Frontend/vite.config.ts` - ä»£ç†é…ç½®
2. âœ… `Frontend/src/components/MarkdownEditor.vue` - ä¸Šä¼ é€»è¾‘
3. âœ… `Frontend/src/views/EditPage.vue` - å›¾ç‰‡è·¯å¾„å¤„ç†
4. âœ… `Frontend/src/components/KnowledgeCardDisplay.vue` - å›¾ç‰‡è·¯å¾„å¤„ç†
5. âœ… `Frontend/src/components/KnowledgeCardPopup.vue` - å›¾ç‰‡è·¯å¾„å¤„ç†
6. âœ… `Frontend/src/components/KnowledgeCardModal.vue` - å›¾ç‰‡è·¯å¾„å¤„ç†

### æœåŠ¡å™¨ä¿¡æ¯
- **åç«¯**: http://localhost:3000 (PID 29312)
- **å‰ç«¯**: http://localhost:5173 (PID 5296)
- **æ•°æ®åº“**: video_cube (MySQL)

---

## ğŸš€ ç°åœ¨å¯ä»¥æµ‹è¯•äº†ï¼

1. **è®¿é—®**: http://localhost:5173
2. **æ¸…é™¤ç¼“å­˜**: Ctrl+Shift+Delete
3. **ä¸Šä¼ å›¾ç‰‡**: æ‹–æ‹½æˆ–ç‚¹å‡»å·¥å…·æ 
4. **éªŒè¯æ˜¾ç¤º**: ç¼–è¾‘å™¨ã€é¢„è§ˆåŒºã€å¡ç‰‡åˆ—è¡¨

å¦‚æœè¿˜æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æä¾›:
- æµè§ˆå™¨ Console çš„å®Œæ•´æ—¥å¿—
- Network æ ‡ç­¾ä¸­ upload-image è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯
- åç«¯ Terminal çš„è¾“å‡º

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: ä»ç„¶æ˜¾ç¤ºæ—§ç«¯å£ (5174)
**A**: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œæˆ–å…³é—­æ‰€æœ‰æ ‡ç­¾é¡µé‡æ–°æ‰“å¼€

### Q2: å›¾ç‰‡ä¸Šä¼ åç«‹å³æ˜¾ç¤ºï¼Œä½†åˆ·æ–°å 404
**A**: æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶æ˜¯å¦çœŸçš„ä¿å­˜åœ¨ `Backend/public/uploads/images/`

### Q3: POST è¯·æ±‚è¿”å› 500 boundary not found
**A**: ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„ vite.config.tsï¼Œå¹¶é‡å¯å‰ç«¯æœåŠ¡å™¨

### Q4: å›¾ç‰‡æ˜¾ç¤ºç°è‰²æˆ–ç ´æŸå›¾æ ‡
**A**: 
1. æ‰“å¼€ Network æ ‡ç­¾æŸ¥çœ‹å›¾ç‰‡è¯·æ±‚çŠ¶æ€ç 
2. å¦‚æœæ˜¯ 404ï¼Œæ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®
3. å¦‚æœæ˜¯ 200ï¼Œå¯èƒ½æ˜¯ MIME ç±»å‹é—®é¢˜

---

**ğŸ‰ æ‰€æœ‰é—®é¢˜å·²ä¿®å¤ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼**
