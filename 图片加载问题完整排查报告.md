# å›¾ç‰‡åŠ è½½é—®é¢˜å®Œæ•´æ’æŸ¥æŠ¥å‘Š

## ğŸ” é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**:
```
å›¾ç‰‡åŠ è½½å¤±è´¥: http://localhost:5173/uploads/images/01466abb-935a-470d-b3fd-1ccfb87ef2ff.png
```

**ç—‡çŠ¶**:
- å›¾ç‰‡ä¸Šä¼ æˆåŠŸ âœ…
- è¿”å›æ­£ç¡®çš„ URL: `/uploads/images/xxx.png` âœ…
- ä½†æ˜¯æµè§ˆå™¨æ— æ³•åŠ è½½å›¾ç‰‡ âŒ

---

## ğŸ“‹ æ’æŸ¥æ¸…å•

### âœ… 1. åç«¯æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥

**æµ‹è¯•å‘½ä»¤**:
```powershell
dir "d:\Code\nodejs\Video_Cube\Backend\public\uploads\images\01466abb-935a-470d-b3fd-1ccfb87ef2ff.png"
```

**ç»“æœ**: 
```
-a----         2025/12/3     10:42         160036 01466abb-935a-470d-b3fd-1ccfb87ef2ff.png
```

**ç»“è®º**: âœ… æ–‡ä»¶å­˜åœ¨

---

### âœ… 2. åç«¯é™æ€æ–‡ä»¶æœåŠ¡æ£€æŸ¥

**æµ‹è¯•å‘½ä»¤**:
```powershell
Invoke-WebRequest -Uri "http://localhost:3000/uploads/images/01466abb-935a-470d-b3fd-1ccfb87ef2ff.png" -Method Head
```

**ç»“æœ**:
```
StatusCode: 200
Content-Length: 160036
Content-Type: image/png
```

**ç»“è®º**: âœ… åç«¯å¯ä»¥æ­£å¸¸è®¿é—®å›¾ç‰‡

---

### âŒ 3. å‰ç«¯ä»£ç†é…ç½®æ£€æŸ¥

**vite.config.ts é…ç½®**:
```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, ''),
    },
    '/uploads': {
      target: 'http://localhost:3000',
      changeOrigin: true,
      secure: false
    }
  }
}
```

**é—®é¢˜å‘ç°**: 
å‰ç«¯è¯·æ±‚ `http://localhost:5173/uploads/images/xxx.png`
åº”è¯¥è¢«ä»£ç†åˆ° `http://localhost:3000/uploads/images/xxx.png`

**æµ‹è¯•ç»“æœ**: âŒ ä»£ç†æœªç”Ÿæ•ˆæˆ–é…ç½®é”™è¯¯

---

### âš ï¸ 4. ç«¯å£å†²çªæ£€æŸ¥

**netstat ç»“æœ**:
```
TCP    127.0.0.1:5173         0.0.0.0:0              LISTENING       5296
```

**ç»ˆç«¯è¾“å‡ºæ˜¾ç¤º**:
```
Port 5173 is in use, trying another one...
VITE v7.1.10  ready in 1189 ms
âœ  Local:   http://localhost:5174/
```

**é—®é¢˜å‘ç°**: 
- æœ‰è¿›ç¨‹å ç”¨ 5173 ç«¯å£
- Vite å®é™…è¿è¡Œåœ¨ 5174 ç«¯å£
- ä½†æ˜¯æµè§ˆå™¨è®¿é—®çš„æ˜¯ 5173 ç«¯å£

**ç»“è®º**: âš ï¸ ç«¯å£æ··ä¹±å¯¼è‡´ä»£ç†é…ç½®å¤±æ•ˆ

---

## ğŸ¯ æ ¹æœ¬åŸå› åˆ†æ

### æ ¸å¿ƒé—®é¢˜: ç«¯å£ä¸ä¸€è‡´

1. **é¢„æœŸé…ç½®**:
   - å‰ç«¯: `http://localhost:5173`
   - åç«¯: `http://localhost:3000`
   - ä»£ç†: Vite å°† `/uploads` è½¬å‘åˆ°åç«¯

2. **å®é™…æƒ…å†µ**:
   - æµè§ˆå™¨è®¿é—®: `http://localhost:5173` (æ—§è¿›ç¨‹/ç¼“å­˜)
   - Vite è¿è¡Œåœ¨: `http://localhost:5174` (æ–°è¿›ç¨‹)
   - ä»£ç†é…ç½®åœ¨ 5174ï¼Œä½†æµè§ˆå™¨è®¿é—® 5173

3. **ç»“æœ**:
   - 5173 ç«¯å£æ²¡æœ‰ä»£ç†é…ç½®
   - è¯·æ±‚ `/uploads/images/xxx.png` æ‰¾ä¸åˆ°èµ„æº
   - è¿”å› 404 é”™è¯¯

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: å½»åº•æ¸…ç†ç«¯å£ï¼ˆæ¨èï¼‰â­

```powershell
# 1. åœæ­¢æ‰€æœ‰ node è¿›ç¨‹
taskkill /F /IM node.exe

# 2. éªŒè¯ç«¯å£å·²é‡Šæ”¾
netstat -ano | findstr "5173"

# 3. å¦‚æœä»å ç”¨ï¼Œæ‰¾åˆ° PID å¹¶æ€æ­»
# å‡è®¾ PID æ˜¯ 12345
taskkill /F /PID 12345

# 4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# æŒ‰ Ctrl+Shift+Delete

# 5. é‡å¯æœåŠ¡
cd d:\Code\nodejs\Video_Cube\Backend
npm start

# åœ¨æ–°ç»ˆç«¯
cd d:\Code\nodejs\Video_Cube\Frontend
npm exec vite

# 6. è®¿é—®æ­£ç¡®çš„åœ°å€
# æ‰“å¼€ http://localhost:5173 (ç¡®ä¿æ˜¯ 5173ï¼Œä¸æ˜¯ 5174)
```

### æ–¹æ¡ˆ 2: ä¿®æ”¹å‰ç«¯é…ç½®ä½¿ç”¨å›ºå®šç«¯å£

**ä¿®æ”¹ vite.config.ts**:
```typescript
export default defineConfig({
  // ...existing code...
  server: {
    port: 5173,  // å¼ºåˆ¶ä½¿ç”¨ 5173 ç«¯å£
    strictPort: true,  // å¦‚æœç«¯å£è¢«å ç”¨åˆ™æŠ¥é”™ï¼Œè€Œä¸æ˜¯è‡ªåŠ¨åˆ‡æ¢
    proxy: {
      // ...existing proxy config...
    }
  }
})
```

### æ–¹æ¡ˆ 3: ä¿®æ”¹æ‰€æœ‰ç»„ä»¶ä½¿ç”¨ç»å¯¹ URL

**ä¸æ¨èï¼Œä½†ä½œä¸ºä¸´æ—¶æ–¹æ¡ˆ**:

åœ¨æ‰€æœ‰æ˜¾ç¤ºå›¾ç‰‡çš„ç»„ä»¶ä¸­ï¼š
```typescript
// å½“å‰: /uploads/images/xxx.png
// æ”¹ä¸º: http://localhost:3000/uploads/images/xxx.png

const imageUrl = `http://localhost:3000${url}`
```

---

## ğŸ§ª éªŒè¯æ­¥éª¤

### 1. éªŒè¯ç«¯å£
```powershell
# å‰ç«¯åº”è¯¥åœ¨ 5173
netstat -ano | findstr "5173"

# åç«¯åº”è¯¥åœ¨ 3000
netstat -ano | findstr "3000"
```

### 2. éªŒè¯åç«¯å›¾ç‰‡è®¿é—®
```powershell
# ç›´æ¥è®¿é—®åç«¯
Invoke-WebRequest -Uri "http://localhost:3000/uploads/images/01466abb-935a-470d-b3fd-1ccfb87ef2ff.png" -Method Head
# åº”è¯¥è¿”å› 200
```

### 3. éªŒè¯å‰ç«¯ä»£ç†
åœ¨æµè§ˆå™¨ Console æ‰§è¡Œ:
```javascript
fetch('/uploads/images/01466abb-935a-470d-b3fd-1ccfb87ef2ff.png')
  .then(r => console.log('Status:', r.status, 'OK:', r.ok))
  .catch(e => console.error('Error:', e))
```

åº”è¯¥è¾“å‡º: `Status: 200 OK: true`

### 4. éªŒè¯å›¾ç‰‡æ˜¾ç¤º
1. ä¸Šä¼ æ–°å›¾ç‰‡
2. è§‚å¯Ÿ Console æ—¥å¿—
3. æ£€æŸ¥ Network æ ‡ç­¾
4. ç¡®è®¤å›¾ç‰‡æ˜¾ç¤º

---

## ğŸ“Š è¯¦ç»†æ—¥å¿—åˆ†æ

### æˆåŠŸçš„æ—¥å¿—åº”è¯¥æ˜¯:

```javascript
// 1. ä¸Šä¼ æˆåŠŸ
å›¾ç‰‡ä¸Šä¼ æˆåŠŸ: {status: true, message: 'å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', data: {url: '/uploads/images/xxx.png'}}

// 2. æ’å…¥æˆåŠŸ
æ’å…¥å›¾ç‰‡URL: /uploads/images/xxx.png

// 3. å¤„ç†æˆåŠŸ
åŸå§‹å›¾ç‰‡URL: /uploads/images/xxx.png
å¤„ç†åå›¾ç‰‡URL: /uploads/images/xxx.png

// 4. Network æ ‡ç­¾æ˜¾ç¤º
Request URL: http://localhost:5173/uploads/images/xxx.png
Status: 200 OK
Type: image/png
```

### å½“å‰å¤±è´¥çš„æ—¥å¿—:

```javascript
// âœ… 1-3 æ­¥éª¤æ­£å¸¸
å›¾ç‰‡ä¸Šä¼ æˆåŠŸ: {status: true, ...}
æ’å…¥å›¾ç‰‡URL: /uploads/images/xxx.png
å¤„ç†åå›¾ç‰‡URL: /uploads/images/xxx.png

// âŒ 4. åŠ è½½å¤±è´¥
Request URL: http://localhost:5173/uploads/images/xxx.png
Status: 404 Not Found  // æˆ–è€… ERR_CONNECTION_REFUSED
```

---

## ğŸ¯ å¿«é€Ÿä¿®å¤è„šæœ¬

åˆ›å»º `fix-image-loading.ps1`:

```powershell
Write-Host "=== ä¿®å¤å›¾ç‰‡åŠ è½½é—®é¢˜ ===" -ForegroundColor Cyan

# 1. åœæ­¢æ‰€æœ‰ Node è¿›ç¨‹
Write-Host "`n[1/5] åœæ­¢æ‰€æœ‰ Node è¿›ç¨‹..." -ForegroundColor Yellow
taskkill /F /IM node.exe 2>$null
Start-Sleep -Seconds 2

# 2. éªŒè¯ç«¯å£å·²é‡Šæ”¾
Write-Host "`n[2/5] éªŒè¯ç«¯å£çŠ¶æ€..." -ForegroundColor Yellow
$port5173 = netstat -ano | Select-String "5173"
$port3000 = netstat -ano | Select-String "3000"

if ($port5173) {
    Write-Host "è­¦å‘Š: ç«¯å£ 5173 ä»è¢«å ç”¨" -ForegroundColor Red
    $port5173
} else {
    Write-Host "ç«¯å£ 5173 å·²é‡Šæ”¾ âœ“" -ForegroundColor Green
}

if ($port3000) {
    Write-Host "è­¦å‘Š: ç«¯å£ 3000 ä»è¢«å ç”¨" -ForegroundColor Red
    $port3000
} else {
    Write-Host "ç«¯å£ 3000 å·²é‡Šæ”¾ âœ“" -ForegroundColor Green
}

# 3. éªŒè¯å›¾ç‰‡æ–‡ä»¶
Write-Host "`n[3/5] éªŒè¯å›¾ç‰‡æ–‡ä»¶..." -ForegroundColor Yellow
$imageCount = (Get-ChildItem "d:\Code\nodejs\Video_Cube\Backend\public\uploads\images" -ErrorAction SilentlyContinue).Count
Write-Host "æ‰¾åˆ° $imageCount ä¸ªå›¾ç‰‡æ–‡ä»¶" -ForegroundColor Green

# 4. å¯åŠ¨åç«¯
Write-Host "`n[4/5] å¯åŠ¨åç«¯æœåŠ¡..." -ForegroundColor Yellow
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd d:\Code\nodejs\Video_Cube\Backend; npm start"
Start-Sleep -Seconds 5

# 5. å¯åŠ¨å‰ç«¯
Write-Host "`n[5/5] å¯åŠ¨å‰ç«¯æœåŠ¡..." -ForegroundColor Yellow
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd d:\Code\nodejs\Video_Cube\Frontend; npm exec vite"
Start-Sleep -Seconds 5

# 6. æµ‹è¯•è¿æ¥
Write-Host "`n[æµ‹è¯•] æ£€æŸ¥æœåŠ¡çŠ¶æ€..." -ForegroundColor Yellow
try {
    $backend = Invoke-WebRequest -Uri "http://localhost:3000" -Method Head -TimeoutSec 3
    Write-Host "åç«¯æœåŠ¡: OK âœ“" -ForegroundColor Green
} catch {
    Write-Host "åç«¯æœåŠ¡: å¤±è´¥ âœ—" -ForegroundColor Red
}

try {
    $frontend = Invoke-WebRequest -Uri "http://localhost:5173" -Method Head -TimeoutSec 3
    Write-Host "å‰ç«¯æœåŠ¡: OK âœ“" -ForegroundColor Green
} catch {
    Write-Host "å‰ç«¯æœåŠ¡: å¤±è´¥ âœ—" -ForegroundColor Red
}

Write-Host "`n=== å®Œæˆ ===" -ForegroundColor Cyan
Write-Host "è¯·è®¿é—®: http://localhost:5173" -ForegroundColor Green
Write-Host "è®°å¾—æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ (Ctrl+Shift+Delete)" -ForegroundColor Yellow
```

---

## ğŸ“ æ€»ç»“

### é—®é¢˜é“¾æ¡

```
ç«¯å£å†²çª (5173 è¢«å ç”¨)
    â†“
Vite åˆ‡æ¢åˆ° 5174
    â†“
æµè§ˆå™¨ä»è®¿é—® 5173 (ç¼“å­˜)
    â†“
5173 æ²¡æœ‰ä»£ç†é…ç½®
    â†“
/uploads è¯·æ±‚æ‰¾ä¸åˆ°èµ„æº
    â†“
å›¾ç‰‡åŠ è½½å¤±è´¥ âŒ
```

### è§£å†³æ­¥éª¤

```
1. æ€æ‰æ‰€æœ‰ Node è¿›ç¨‹ âœ“
2. ç¡®ä¿ 5173 å’Œ 3000 ç«¯å£ç©ºé—² âœ“
3. é‡å¯åç«¯æœåŠ¡ (3000) âœ“
4. é‡å¯å‰ç«¯æœåŠ¡ (5173) âœ“
5. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ âœ“
6. è®¿é—® http://localhost:5173 âœ“
7. æµ‹è¯•å›¾ç‰‡ä¸Šä¼ å’Œæ˜¾ç¤º âœ“
```

### é¢„é˜²æªæ–½

1. **å¼ºåˆ¶ç«¯å£é…ç½®**: åœ¨ `vite.config.ts` è®¾ç½® `strictPort: true`
2. **è‡ªåŠ¨ç«¯å£æ£€æŸ¥**: å¯åŠ¨å‰æ£€æŸ¥ç«¯å£å ç”¨
3. **ä½¿ç”¨ PM2**: ç®¡ç†è¿›ç¨‹ï¼Œé¿å…åƒµå°¸è¿›ç¨‹
4. **ç¯å¢ƒå˜é‡**: ä½¿ç”¨ `.env` æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ç«¯å£é…ç½®

---

**å…³é”®ç‚¹**: è¿™ä¸æ˜¯ä»£ç é—®é¢˜ï¼Œæ˜¯**ç«¯å£ç®¡ç†é—®é¢˜**ï¼ ğŸ¯
