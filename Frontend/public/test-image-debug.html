<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡åŠ è½½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        h2 {
            color: #333;
            margin-top: 0;
        }
        img {
            max-width: 100%;
            border: 3px solid #4CAF50;
            margin: 10px 0;
            display: block;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .info {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #2196F3;
            margin: 10px 0;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª å›¾ç‰‡åŠ è½½æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯• 1: ç›´æ¥ä½¿ç”¨ img æ ‡ç­¾ (æ—  crossorigin)</h2>
        <div class="info">
            <strong>å›¾ç‰‡URL:</strong><br>
            <code>http://localhost:3000/uploads/images/3e778a74-5c69-43fd-8b92-49b206613bf7.png</code>
        </div>
        <img 
            id="test1"
            src="http://localhost:3000/uploads/images/3e778a74-5c69-43fd-8b92-49b206613bf7.png" 
            alt="æµ‹è¯•å›¾ç‰‡1"
            onload="document.getElementById('result1').innerHTML = 'âœ… <span class=success>åŠ è½½æˆåŠŸ!</span>'; console.log('Test1 åŠ è½½æˆåŠŸ');"
            onerror="document.getElementById('result1').innerHTML = 'âŒ <span class=error>åŠ è½½å¤±è´¥!</span>'; console.error('Test1 åŠ è½½å¤±è´¥', event);"
        >
        <div id="result1" style="margin-top: 10px; font-size: 18px;">â³ åŠ è½½ä¸­...</div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯• 2: ä½¿ç”¨ crossorigin="anonymous"</h2>
        <div class="info">
            <strong>å›¾ç‰‡URL:</strong><br>
            <code>http://localhost:3000/uploads/images/3e778a74-5c69-43fd-8b92-49b206613bf7.png</code>
        </div>
        <img 
            id="test2"
            src="http://localhost:3000/uploads/images/3e778a74-5c69-43fd-8b92-49b206613bf7.png" 
            alt="æµ‹è¯•å›¾ç‰‡2"
            crossorigin="anonymous"
            onload="document.getElementById('result2').innerHTML = 'âœ… <span class=success>åŠ è½½æˆåŠŸ!</span>'; console.log('Test2 åŠ è½½æˆåŠŸ');"
            onerror="document.getElementById('result2').innerHTML = 'âŒ <span class=error>åŠ è½½å¤±è´¥!</span>'; console.error('Test2 åŠ è½½å¤±è´¥', event);"
        >
        <div id="result2" style="margin-top: 10px; font-size: 18px;">â³ åŠ è½½ä¸­...</div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯• 3: ä½¿ç”¨ crossorigin="use-credentials"</h2>
        <div class="info">
            <strong>å›¾ç‰‡URL:</strong><br>
            <code>http://localhost:3000/uploads/images/3e778a74-5c69-43fd-8b92-49b206613bf7.png</code>
        </div>
        <img 
            id="test3"
            src="http://localhost:3000/uploads/images/3e778a74-5c69-43fd-8b92-49b206613bf7.png" 
            alt="æµ‹è¯•å›¾ç‰‡3"
            crossorigin="use-credentials"
            onload="document.getElementById('result3').innerHTML = 'âœ… <span class=success>åŠ è½½æˆåŠŸ!</span>'; console.log('Test3 åŠ è½½æˆåŠŸ');"
            onerror="document.getElementById('result3').innerHTML = 'âŒ <span class=error>åŠ è½½å¤±è´¥!</span>'; console.error('Test3 åŠ è½½å¤±è´¥', event);"
        >
        <div id="result3" style="margin-top: 10px; font-size: 18px;">â³ åŠ è½½ä¸­...</div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯• 4: JavaScript åŠ¨æ€åˆ›å»º</h2>
        <div class="info">
            <strong>å›¾ç‰‡URL:</strong><br>
            <code>http://localhost:3000/uploads/images/3e778a74-5c69-43fd-8b92-49b206613bf7.png</code>
        </div>
        <div id="test4-container"></div>
        <div id="result4" style="margin-top: 10px; font-size: 18px;">â³ åŠ è½½ä¸­...</div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯• 5: æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶æ˜¯å¦çœŸå®å­˜åœ¨</h2>
        <div id="result5" style="margin-top: 10px; font-size: 18px;">â³ æ£€æŸ¥ä¸­...</div>
        <pre id="fetch-details" style="background: #f5f5f5; padding: 10px; border-radius: 4px;"></pre>
    </div>

    <script>
        console.log('=== å›¾ç‰‡åŠ è½½æµ‹è¯•å¼€å§‹ ===');
        
        // æµ‹è¯• 4: JavaScript åŠ¨æ€åˆ›å»º
        const img4 = document.createElement('img');
        img4.src = 'http://localhost:3000/uploads/images/3e778a74-5c69-43fd-8b92-49b206613bf7.png';
        img4.alt = 'æµ‹è¯•å›¾ç‰‡4';
        img4.style.maxWidth = '100%';
        img4.style.border = '3px solid #4CAF50';
        img4.onload = () => {
            console.log('Test4 åŠ è½½æˆåŠŸ');
            document.getElementById('result4').innerHTML = 'âœ… <span class="success">åŠ è½½æˆåŠŸ!</span>';
        };
        img4.onerror = (e) => {
            console.error('Test4 åŠ è½½å¤±è´¥:', e);
            document.getElementById('result4').innerHTML = 'âŒ <span class="error">åŠ è½½å¤±è´¥!</span>';
        };
        document.getElementById('test4-container').appendChild(img4);

        // æµ‹è¯• 5: Fetch API æ£€æŸ¥
        fetch('http://localhost:3000/uploads/images/3e778a74-5c69-43fd-8b92-49b206613bf7.png', {
            method: 'HEAD',
            mode: 'cors'
        })
        .then(response => {
            console.log('Fetch HEAD å“åº”:', response);
            const details = `çŠ¶æ€ç : ${response.status} ${response.statusText}
Content-Type: ${response.headers.get('content-type')}
Content-Length: ${response.headers.get('content-length')}
CORS Origin: ${response.headers.get('access-control-allow-origin')}
CORS Credentials: ${response.headers.get('access-control-allow-credentials')}`;
            
            document.getElementById('fetch-details').textContent = details;
            
            if (response.ok) {
                document.getElementById('result5').innerHTML = 'âœ… <span class="success">å›¾ç‰‡æ–‡ä»¶å­˜åœ¨,å¯è®¿é—®!</span>';
            } else {
                document.getElementById('result5').innerHTML = 'âŒ <span class="error">å›¾ç‰‡ä¸å­˜åœ¨: ' + response.status + '</span>';
            }
        })
        .catch(error => {
            console.error('Fetch é”™è¯¯:', error);
            document.getElementById('result5').innerHTML = 'âŒ <span class="error">Fetch å¤±è´¥: ' + error.message + '</span>';
            document.getElementById('fetch-details').textContent = 'é”™è¯¯: ' + error.toString();
        });

        // å…¨å±€é”™è¯¯ç›‘å¬
        window.addEventListener('error', (e) => {
            if (e.target.tagName === 'IMG') {
                console.error('ğŸ”´ å…¨å±€å›¾ç‰‡åŠ è½½é”™è¯¯:', {
                    src: e.target.src,
                    alt: e.target.alt,
                    crossOrigin: e.target.crossOrigin,
                    error: e
                });
            }
        }, true);

        console.log('=== æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ ===');
    </script>
</body>
</html>
