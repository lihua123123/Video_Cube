# çŸ¥è¯†å¡ç‰‡å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜æ’æŸ¥ä¸è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°
çŸ¥è¯†å¡ç‰‡ä¸­çš„ Markdown æ ¼å¼å›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚

## æ’æŸ¥æ­¥éª¤

### 1. åç«¯æœåŠ¡å™¨çŠ¶æ€ âœ…
- åç«¯æœåŠ¡å™¨å·²å¯åŠ¨åœ¨ç«¯å£ 3000
- æ•°æ®åº“è¿æ¥æ­£å¸¸

### 2. å›¾ç‰‡è·¯å¾„æ£€æŸ¥

#### å½“å‰å®ç°
```vue
// EditPage.vue - formatContent å‡½æ•°
formatted = formatted.replace(/!\[([^\]]*)\]\(([^)"\s]+)(?:\s+"([^"]*)")?\)/g, (match, alt, url, title) => {
  const apiBaseUrl = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000';
  const imageUrl = url.startsWith('/uploads') ? `${apiBaseUrl}${url}` : url;
  return `<img src="${imageUrl}" alt="${alt}" title="${title || alt}" class="content-image" loading="lazy" onerror="console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', this.src)">`
})
```

#### é—®é¢˜åˆ†æ
å¯èƒ½çš„é—®é¢˜ï¼š
1. â“ ç¯å¢ƒå˜é‡ `VITE_API_BASE_URL` æœªæ­£ç¡®é…ç½®
2. â“ Vite ä»£ç†é…ç½®å¯èƒ½æœ‰é—®é¢˜
3. â“ å›¾ç‰‡è·¯å¾„æ ¼å¼ä¸æ­£ç¡®
4. â“ CORS è·¨åŸŸé—®é¢˜

### 3. è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ A: æ£€æŸ¥å¹¶ä¿®å¤ç¯å¢ƒå˜é‡é…ç½®

**æ­¥éª¤ 1**: æ£€æŸ¥ `.env.local` æ–‡ä»¶
```bash
# Frontend/.env.local
VITE_API_BASE_URL=http://localhost:3000
```

**æ­¥éª¤ 2**: é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨
å‰ç«¯ä¿®æ”¹ `.env.local` åéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆã€‚

#### æ–¹æ¡ˆ B: ä¿®å¤ Vite ä»£ç†é…ç½®

**æ£€æŸ¥ vite.config.ts**:
```typescript
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true
      },
      '/uploads': {
        target: 'http://localhost:3000',
        changeOrigin: true
      }
    }
  }
})
```

#### æ–¹æ¡ˆ C: ä½¿ç”¨ç›¸å¯¹è·¯å¾„ + Vite ä»£ç†ï¼ˆæ¨èï¼‰

è¿™æ ·å¯ä»¥é¿å…è·¨åŸŸé—®é¢˜ï¼Œå¹¶ä¸”åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ›´çµæ´»ã€‚

**ä¿®æ”¹å›¾ç‰‡å¤„ç†é€»è¾‘**:
```typescript
// åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè®© Vite ä»£ç†å¤„ç†
const imageUrl = url.startsWith('http') ? url : url;
// ä¸éœ€è¦æ·»åŠ  apiBaseUrlï¼Œè®© Vite ä»£ç†è‡ªåŠ¨å¤„ç† /uploads è·¯å¾„
```

### 4. è°ƒè¯•å»ºè®®

#### åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. æ‰“å¼€ Network é€‰é¡¹å¡
3. è¿‡æ»¤ "Img" ç±»å‹
4. æŸ¥çœ‹å›¾ç‰‡è¯·æ±‚ï¼š
   - è¯·æ±‚ URL æ˜¯ä»€ä¹ˆï¼Ÿ
   - çŠ¶æ€ç æ˜¯å¤šå°‘ï¼Ÿ(200=æˆåŠŸ, 404=æœªæ‰¾åˆ°, 403=ç¦æ­¢è®¿é—®)
   - å“åº”å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ

#### æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—
```javascript
// å·²ç»æ·»åŠ äº†è°ƒè¯•æ—¥å¿—
console.log('å›¾ç‰‡URL:', url);
console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', this.src)
```

### 5. å¸¸è§é—®é¢˜ä¸è§£å†³

#### é—®é¢˜ 1: å›¾ç‰‡ 404 Not Found
**åŸå› **: å›¾ç‰‡è·¯å¾„é”™è¯¯æˆ–æ–‡ä»¶ä¸å­˜åœ¨
**è§£å†³**: 
- æ£€æŸ¥å›¾ç‰‡å®é™…å­˜å‚¨ä½ç½®ï¼š`Backend/public/uploads/images/`
- éªŒè¯æ•°æ®åº“ä¸­çš„è·¯å¾„æ ¼å¼

#### é—®é¢˜ 2: å›¾ç‰‡ 403 Forbidden
**åŸå› **: æƒé™é—®é¢˜
**è§£å†³**: æ£€æŸ¥ Express é™æ€æ–‡ä»¶é…ç½®

#### é—®é¢˜ 3: CORS é”™è¯¯
**åŸå› **: è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢
**è§£å†³**: 
```javascript
// Backend/app.js
app.use(cors({
  origin: 'http://localhost:5174',
  credentials: true
}))
```

#### é—®é¢˜ 4: å›¾ç‰‡è·¯å¾„æ ¼å¼é—®é¢˜
**æ•°æ®åº“ä¸­çš„æ ¼å¼åº”è¯¥æ˜¯**:
- âœ… `![æè¿°](/uploads/images/xxx.png)`
- âœ… `![æè¿°](http://localhost:3000/uploads/images/xxx.png)`
- âŒ `![æè¿°](uploads/images/xxx.png)` (ç¼ºå°‘å‰å¯¼ `/`)

### 6. å®Œæ•´çš„æµ‹è¯•æµç¨‹

#### æ­¥éª¤ 1: æµ‹è¯•åç«¯å›¾ç‰‡æœåŠ¡
```bash
# åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®
http://localhost:3000/uploads/images/xxx.png
```
å¦‚æœèƒ½çœ‹åˆ°å›¾ç‰‡ï¼Œè¯´æ˜åç«¯é…ç½®æ­£ç¡®ã€‚

#### æ­¥éª¤ 2: æµ‹è¯• Vite ä»£ç†
```bash
# åœ¨å‰ç«¯é¡µé¢æ§åˆ¶å°æ‰§è¡Œ
fetch('/uploads/images/xxx.png')
  .then(r => console.log('Status:', r.status))
```
å¦‚æœè¿”å› 200ï¼Œè¯´æ˜ä»£ç†é…ç½®æ­£ç¡®ã€‚

#### æ­¥éª¤ 3: æ£€æŸ¥å®é™…æ¸²æŸ“çš„ HTML
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æ¸²æŸ“åçš„å›¾ç‰‡æ ‡ç­¾
document.querySelectorAll('.content-image').forEach(img => {
  console.log('å›¾ç‰‡ src:', img.src);
  console.log('å›¾ç‰‡çŠ¶æ€:', img.complete ? 'å·²åŠ è½½' : 'åŠ è½½ä¸­');
})
```

### 7. æ¨èçš„æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

#### ä¿®æ”¹ 1: ç»Ÿä¸€ä½¿ç”¨ç›¸å¯¹è·¯å¾„
```typescript
// EditPage.vue - formatContent
formatted = formatted.replace(/!\[([^\]]*)\]\(([^)"\s]+)(?:\s+"([^"]*)")?\)/g, (match, alt, url, title) => {
  // ä¿æŒåŸæ ·ï¼Œè®© Vite ä»£ç†å¤„ç†
  // åªå¯¹ç»å¯¹ URL (http/https å¼€å¤´) ä¿æŒä¸å˜
  const imageUrl = url.startsWith('http') ? url : url;
  console.log('å¤„ç†å›¾ç‰‡ - åŸå§‹:', url, 'å¤„ç†å:', imageUrl);
  return `<img src="${imageUrl}" alt="${alt}" title="${title || alt}" class="content-image" loading="lazy" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3Eå›¾ç‰‡åŠ è½½å¤±è´¥%3C/text%3E%3C/svg%3E'">`
})
```

#### ä¿®æ”¹ 2: KnowledgeCardDisplay.vue åŒæ­¥ä¿®æ”¹
```typescript
// KnowledgeCardDisplay.vue - generatePreview
preview = preview.replace(/!\[([^\]]*)\]\(([^)"\s]+)(?:\s+"([^"]*)")?\)/g, (match, alt, url, title) => {
  const imageUrl = url.startsWith('http') ? url : url;
  const imageId = `__image_${imageCounter++}__`;
  imageMap[imageId] = `<img src="${imageUrl}" alt="${alt}" title="${title || alt}" class="content-image preview-image" loading="lazy">`;
  return imageId;
});
```

#### ä¿®æ”¹ 3: Toast UI Editor ä¸Šä¼ å›è°ƒ
```typescript
// MarkdownEditor.vue - addImageBlobHook
if (response.ok) {
  const data = await response.json()
  // ç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¸åŠ åŸŸå
  const imageUrl = data.url  // åº”è¯¥è¿”å› /uploads/images/xxx.png
  const fileName = (blob as File).name || 'image'
  callback(imageUrl, fileName)
}
```

### 8. éªŒè¯æ­¥éª¤

å®Œæˆä¿®æ”¹åï¼š
1. âœ… é‡å¯å‰ç«¯æœåŠ¡å™¨
2. âœ… ç¡®ä¿åç«¯æœåŠ¡å™¨è¿è¡Œ
3. âœ… æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
4. âœ… ä¸Šä¼ æ–°å›¾ç‰‡æµ‹è¯•
5. âœ… ç¼–è¾‘å·²æœ‰å¡ç‰‡æµ‹è¯•
6. âœ… åœ¨é¢„è§ˆåŒºæŸ¥çœ‹å›¾ç‰‡
7. âœ… åœ¨çŸ¥è¯†å¡ç‰‡åˆ—è¡¨æŸ¥çœ‹å›¾ç‰‡

### 9. æ³¨æ„äº‹é¡¹

- ğŸ“Œ å‰ç«¯ç«¯å£: http://localhost:5174
- ğŸ“Œ åç«¯ç«¯å£: http://localhost:3000
- ğŸ“Œ å›¾ç‰‡å­˜å‚¨: Backend/public/uploads/images/
- ğŸ“Œ æ•°æ®åº“è·¯å¾„æ ¼å¼: `/uploads/images/xxx.png` æˆ–å®Œæ•´ URL

---

## ç«‹å³æ‰§è¡Œçš„æ£€æŸ¥å‘½ä»¤

```powershell
# 1. æ£€æŸ¥åç«¯æœåŠ¡å™¨
netstat -ano | findstr :3000

# 2. æ£€æŸ¥å‰ç«¯æœåŠ¡å™¨  
netstat -ano | findstr :5174

# 3. æ£€æŸ¥å›¾ç‰‡ç›®å½•
dir "d:\Code\nodejs\Video_Cube\Backend\public\uploads\images"

# 4. æŸ¥çœ‹ç¯å¢ƒå˜é‡æ–‡ä»¶
type "d:\Code\nodejs\Video_Cube\Frontend\.env.local"
```

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

è¯·åœ¨æµè§ˆå™¨ä¸­ï¼š
1. æ‰“å¼€ http://localhost:5174
2. æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
3. æ‰“å¼€ Network é€‰é¡¹å¡
4. å°è¯•æ˜¾ç¤ºçŸ¥è¯†å¡ç‰‡
5. æŸ¥çœ‹å›¾ç‰‡è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯
6. å°†é”™è¯¯ä¿¡æ¯åé¦ˆç»™æˆ‘
