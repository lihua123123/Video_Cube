# è§†é¢‘åº“æ’­æ”¾é—®é¢˜æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·ç‚¹å‡»è§†é¢‘åº“ä¸­çš„è§†é¢‘å,è§†é¢‘æ— æ³•åœ¨æ’­æ”¾å™¨ä¸­æ’­æ”¾ã€‚

## ğŸ” é—®é¢˜æ ¹æº

### é—®é¢˜åˆ†æ

ç»è¿‡æµ‹è¯•å‘ç°:

1. **åç«¯è®¿é—®æ­£å¸¸** âœ…
   - `http://localhost:3000/uploads/videos/xxx.mp4` å¯ä»¥æ­£å¸¸è®¿é—®
   - è¿”å› `video/mp4` å†…å®¹

2. **`/uploads` ä»£ç†ä¸å·¥ä½œ** âŒ
   - `http://localhost:5173/uploads/videos/xxx.mp4` è¿”å›HTMLè€Œä¸æ˜¯è§†é¢‘
   - è¯´æ˜Viteçš„ `/uploads` ä»£ç†é…ç½®æœ‰é—®é¢˜æˆ–æœªç”Ÿæ•ˆ

3. **`/api` ä»£ç†å·¥ä½œæ­£å¸¸** âœ…
   - `http://localhost:5173/api/uploads/videos/xxx.mp4` å¯ä»¥æ­£å¸¸è®¿é—®
   - é€šè¿‡ `/api` ä»£ç†é‡å†™åæ­£ç¡®è½¬å‘åˆ°åç«¯

### ä»£ç é—®é¢˜

**UserPage.vue ä¸­çš„ `handleLibraryVideoPlay` å‡½æ•°:**

```typescript
// âŒ é”™è¯¯ä»£ç  (ä¹‹å‰)
const fullUrl = video.video_url  // ç›´æ¥ä½¿ç”¨ /uploads/videos/xxx.mp4
```

è¿™ä¼šå¯¼è‡´:
- æµè§ˆå™¨è¯·æ±‚: `http://localhost:5173/uploads/videos/xxx.mp4`
- é€šè¿‡ `/uploads` ä»£ç†
- ä½†æ˜¯ `/uploads` ä»£ç†è¿”å›HTMLé¡µé¢,ä¸æ˜¯è§†é¢‘
- âŒ è§†é¢‘æ— æ³•æ’­æ”¾

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹ä»£ç 

**æ–‡ä»¶:** `Frontend/src/views/UserPage.vue` (ç¬¬487-497è¡Œ)

**ä¿®æ”¹å‰:**
```typescript
const handleLibraryVideoPlay = (video: LibraryVideo) => {
  // æ’­æ”¾é€‰ä¸­çš„è§†é¢‘
  // video_url æ ¼å¼: /uploads/videos/xxx.mp4
  // ç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„,é€šè¿‡Viteä»£ç†è®¿é—®åç«¯
  const fullUrl = video.video_url.startsWith('http') ? 
    video.video_url : 
    video.video_url  // âŒ ä½¿ç”¨ç›¸å¯¹è·¯å¾„,è®©Viteä»£ç†å¤„ç†
  
  currentVideo.value = fullUrl
  videoUrl.value = fullUrl
  videoId.value = video.id
  // ...
}
```

**ä¿®æ”¹å:**
```typescript
const handleLibraryVideoPlay = (video: LibraryVideo) => {
  // æ’­æ”¾é€‰ä¸­çš„è§†é¢‘
  // video_url æ ¼å¼: /uploads/videos/xxx.mp4
  // æ·»åŠ  /api å‰ç¼€,é€šè¿‡Viteçš„ /api ä»£ç†è®¿é—®åç«¯
  const fullUrl = video.video_url.startsWith('http') ? 
    video.video_url : 
    `/api${video.video_url}`  // âœ… æ·»åŠ  /api å‰ç¼€,é€šè¿‡ä»£ç†é‡å†™åå˜æˆæ­£ç¡®çš„åç«¯è·¯å¾„
  
  currentVideo.value = fullUrl
  videoUrl.value = fullUrl
  videoId.value = video.id
  // ...
}
```

## ğŸ”„ å·¥ä½œæµç¨‹

### ä¿®å¤åçš„å®Œæ•´æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»è§†é¢‘åº“ä¸­çš„"æ’­æ”¾"æŒ‰é’®
   â†“
2. è§¦å‘ handleLibraryVideoPlay(video)
   video.video_url = "/uploads/videos/xxx.mp4"
   â†“
3. æ·»åŠ  /api å‰ç¼€
   fullUrl = "/api/uploads/videos/xxx.mp4"
   â†“
4. è®¾ç½®åˆ° <video> æ ‡ç­¾çš„ src å±æ€§
   <video src="/api/uploads/videos/xxx.mp4">
   â†“
5. æµè§ˆå™¨è¯·æ±‚è§†é¢‘
   GET http://localhost:5173/api/uploads/videos/xxx.mp4
   â†“
6. Vite /api ä»£ç†æ‹¦æˆª
   â†“
7. åº”ç”¨ rewrite è§„åˆ™
   /api/uploads/videos/xxx.mp4 â†’ /uploads/videos/xxx.mp4
   â†“
8. è½¬å‘åˆ°åç«¯
   GET http://localhost:3000/uploads/videos/xxx.mp4
   â†“
9. Express é™æ€æ–‡ä»¶æœåŠ¡å¤„ç†
   ä» public/ ç›®å½•æä¾›æ–‡ä»¶
   â†“
10. è¿”å›è§†é¢‘æ–‡ä»¶
    Content-Type: video/mp4
    Content-Length: 35383931
    â†“
11. æµè§ˆå™¨æ¥æ”¶è§†é¢‘æ•°æ®
    â†“
12. âœ… è§†é¢‘æ­£å¸¸æ’­æ”¾!
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. åç«¯æµ‹è¯•

```bash
cd Backend
node test_api_upload_path.js
```

**é¢„æœŸè¾“å‡º:**
```
âœ… æˆåŠŸ! /api ä»£ç†å¯ä»¥æ­£ç¡®è®¿é—®è§†é¢‘æ–‡ä»¶
çŠ¶æ€ç : 200
Content-Type: video/mp4
Content-Length: 35383931
```

### 2. å‰ç«¯æµ‹è¯•

**é‡è¦:** ä»£ç ä¿®æ”¹åéœ€è¦å‰ç«¯è‡ªåŠ¨çƒ­æ›´æ–°,æˆ–è€…æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨ã€‚

1. æ‰“å¼€å‰ç«¯é¡µé¢ (http://localhost:5173)
2. ç‚¹å‡» "ğŸ“š è§†é¢‘åº“" æŒ‰é’®
3. ç‚¹å‡»ä»»æ„è§†é¢‘çš„ "â–¶ï¸ æ’­æ”¾" æŒ‰é’®
4. è§†é¢‘åº”è¯¥åœ¨ä¸»æ’­æ”¾å™¨ä¸­æ­£å¸¸æ’­æ”¾

### 3. æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12):

**ç½‘ç»œ (Network) æ ‡ç­¾é¡µ:**
- æ‰¾åˆ°è§†é¢‘æ–‡ä»¶è¯·æ±‚
- URLåº”è¯¥æ˜¯: `/api/uploads/videos/xxx.mp4`
- çŠ¶æ€ç : `200`
- ç±»å‹: `video/mp4`
- å¤§å°: çº¦35MB

**æ§åˆ¶å° (Console) æ ‡ç­¾é¡µ:**
- åº”è¯¥çœ‹åˆ°: "æ­£åœ¨æ’­æ”¾: [è§†é¢‘æ ‡é¢˜]" çš„é€šçŸ¥
- ä¸åº”è¯¥æœ‰ä»»ä½•é”™è¯¯ä¿¡æ¯

## ğŸ“Š æŠ€æœ¯ç»†èŠ‚

### Vite ä»£ç†é…ç½®

**æ–‡ä»¶:** `Frontend/vite.config.ts`

```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, '')  // å…³é”®: å»æ‰ /api å‰ç¼€
    },
    '/uploads': {
      target: 'http://localhost:3000',
      changeOrigin: true
      // âš ï¸ è¿™ä¸ªé…ç½®æœ‰é—®é¢˜,ä¸èƒ½æ­£å¸¸å·¥ä½œ
    }
  }
}
```

### ä¸ºä»€ä¹ˆä½¿ç”¨ `/api` ä»£ç†è€Œä¸æ˜¯ `/uploads` ä»£ç†?

1. **`/api` ä»£ç†æœ‰ rewrite è§„åˆ™**
   - è¯·æ±‚: `/api/uploads/videos/xxx.mp4`
   - é‡å†™ä¸º: `/uploads/videos/xxx.mp4`
   - è½¬å‘åˆ°åç«¯: `http://localhost:3000/uploads/videos/xxx.mp4`
   - âœ… å®Œç¾åŒ¹é…åç«¯çš„é™æ€æ–‡ä»¶è·¯å¾„

2. **`/uploads` ä»£ç†æ²¡æœ‰é‡å†™è§„åˆ™**
   - è¯·æ±‚: `/uploads/videos/xxx.mp4`
   - ç›´æ¥è½¬å‘: `http://localhost:3000/uploads/videos/xxx.mp4`
   - âŒ ä½†å®é™…æµ‹è¯•å‘ç°è¿”å›HTMLè€Œä¸æ˜¯è§†é¢‘
   - å¯èƒ½æ˜¯Viteå†…éƒ¨è·¯ç”±å†²çªæˆ–é…ç½®é—®é¢˜

## ğŸ¯ å…³é”®è¦ç‚¹

### 1. URL æ„å»ºç­–ç•¥

æ‰€æœ‰ä»åç«¯è·å–çš„èµ„æºè·¯å¾„éƒ½åº”è¯¥æ·»åŠ  `/api` å‰ç¼€:

```typescript
// æ•°æ®åº“ä¸­çš„è·¯å¾„
video_url: "/uploads/videos/xxx.mp4"
thumbnail_url: "/uploads/thumbnails/xxx.jpg"

// å‰ç«¯ä½¿ç”¨æ—¶
const videoUrl = `/api${video.video_url}`      // âœ… æ­£ç¡®
const thumbnailUrl = `/api${video.thumbnail_url}` // âœ… æ­£ç¡®

// é”™è¯¯åšæ³•
const videoUrl = video.video_url  // âŒ é”™è¯¯: ç»•è¿‡å·¥ä½œçš„ä»£ç†
```

### 2. VideoLibrary ç»„ä»¶çš„ getFullUrl å‡½æ•°

è¿™ä¸ªå‡½æ•°å·²ç»æ­£ç¡®å®ç°äº†æ·»åŠ  `/api` å‰ç¼€:

```typescript
// Frontend/src/components/VideoLibrary.vue
const getFullUrl = (url: string) => {
  if (!url) return '';
  if (url.startsWith('http')) return url;
  return `/api${url}`;  // âœ… æ­£ç¡®: æ·»åŠ  /api å‰ç¼€
};
```

ç¼©ç•¥å›¾ä½¿ç”¨è¿™ä¸ªå‡½æ•°,æ‰€ä»¥ç¼©ç•¥å›¾å¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚

### 3. ä¿æŒä¸€è‡´æ€§

UserPage å’Œ VideoLibrary åº”è¯¥ä½¿ç”¨ç›¸åŒçš„URLæ„å»ºç­–ç•¥:
- âœ… éƒ½ä½¿ç”¨ `/api` å‰ç¼€
- âœ… é€šè¿‡ç›¸åŒçš„ä»£ç†è§„åˆ™
- âœ… è¡Œä¸ºä¸€è‡´å¯é¢„æµ‹

## ğŸ“ å¯¹æ¯”æ€»ç»“

| æ–¹é¢ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| è§†é¢‘URL | `/uploads/videos/xxx.mp4` | `/api/uploads/videos/xxx.mp4` |
| ä»£ç†è·¯å¾„ | `/uploads` (ä¸å·¥ä½œ) | `/api` (å·¥ä½œæ­£å¸¸) |
| æµè§ˆå™¨è¯·æ±‚ | `http://localhost:5173/uploads/...` | `http://localhost:5173/api/uploads/...` |
| åç«¯æ¥æ”¶ | âŒ è¿”å›HTML | âœ… è¿”å›è§†é¢‘æ–‡ä»¶ |
| Content-Type | `text/html` | `video/mp4` |
| è§†é¢‘æ’­æ”¾ | âŒ æ— æ³•æ’­æ”¾ | âœ… æ­£å¸¸æ’­æ”¾ |

## ğŸ”§ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### æ£€æŸ¥æ¸…å•

1. **ç¡®è®¤ä»£ç å·²ä¿®æ”¹**
   - [ ] UserPage.vue ä¸­çš„ `handleLibraryVideoPlay` å·²æ›´æ–°
   - [ ] ä½¿ç”¨äº† `/api${video.video_url}` è€Œä¸æ˜¯ `video.video_url`

2. **ç¡®è®¤å‰ç«¯å·²æ›´æ–°**
   - [ ] æµè§ˆå™¨å·²åˆ·æ–° (Ctrl + R æˆ– F5)
   - [ ] æˆ–ç­‰å¾…Viteçƒ­æ›´æ–°å®Œæˆ(é€šå¸¸è‡ªåŠ¨)

3. **æ£€æŸ¥ç½‘ç»œè¯·æ±‚**
   - [ ] æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
   - [ ] åˆ‡æ¢åˆ° Network æ ‡ç­¾
   - [ ] æ’­æ”¾è§†é¢‘
   - [ ] æŸ¥çœ‹è§†é¢‘è¯·æ±‚çš„URLæ˜¯å¦åŒ…å« `/api` å‰ç¼€
   - [ ] æŸ¥çœ‹å“åº”çš„ Content-Type æ˜¯å¦ä¸º `video/mp4`

4. **æ£€æŸ¥æ§åˆ¶å°é”™è¯¯**
   - [ ] Console æ ‡ç­¾ä¸­æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
   - [ ] æ˜¯å¦æœ‰CORSé”™è¯¯
   - [ ] æ˜¯å¦æœ‰404é”™è¯¯

### æ•…éšœæ’é™¤

**å¦‚æœURLä»ç„¶æ˜¯ `/uploads` è€Œä¸æ˜¯ `/api/uploads`:**
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜: Ctrl + Shift + R (ç¡¬åˆ·æ–°)
- æˆ–è€…é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨:
  ```bash
  cd Frontend
  # Ctrl+C åœæ­¢
  npm run dev
  ```

**å¦‚æœçŠ¶æ€ç æ˜¯404:**
- ç¡®è®¤è§†é¢‘æ–‡ä»¶å­˜åœ¨: `Backend/public/uploads/videos/`
- è¿è¡Œæµ‹è¯•è„šæœ¬: `node Backend/check_video_urls.js`

**å¦‚æœContent-Typeä¸æ˜¯ video/mp4:**
- æ£€æŸ¥åç«¯é™æ€æ–‡ä»¶é…ç½®
- ç¡®è®¤ `app.use(express.static(path.join(__dirname, 'public')))` å­˜åœ¨

## ğŸ‰ ä¿®å¤å®Œæˆ

ä¿®æ”¹äº†ä¸€è¡Œä»£ç å°±è§£å†³äº†é—®é¢˜!

**æ ¸å¿ƒä¿®æ”¹:**
```typescript
// åªéœ€è¦è¿™ä¸€ä¸ªæ”¹åŠ¨
const fullUrl = `/api${video.video_url}`  // æ·»åŠ  /api å‰ç¼€
```

è¿™ä¸ªç®€å•çš„ä¿®æ”¹ç¡®ä¿äº†:
- âœ… è§†é¢‘è¯·æ±‚é€šè¿‡å·¥ä½œæ­£å¸¸çš„ `/api` ä»£ç†
- âœ… URLé‡å†™è§„åˆ™æ­£ç¡®åº”ç”¨
- âœ… åç«¯æ­£ç¡®è¿”å›è§†é¢‘æ–‡ä»¶
- âœ… æµè§ˆå™¨å¯ä»¥æ’­æ”¾è§†é¢‘

---

**ç°åœ¨è§†é¢‘åº”è¯¥å¯ä»¥æ­£å¸¸æ’­æ”¾äº†! ğŸ¬**

å¦‚æœè¿˜æœ‰é—®é¢˜,è¯·:
1. åˆ·æ–°æµè§ˆå™¨é¡µé¢
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ç½‘ç»œè¯·æ±‚
3. ç¡®è®¤è§†é¢‘URLåŒ…å« `/api` å‰ç¼€
