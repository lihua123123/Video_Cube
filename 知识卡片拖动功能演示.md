# 知识卡片拖动功能演示

## 🎯 功能概述

知识卡片弹窗现在支持**自由拖动**！用户可以将弹窗移动到任意位置，避免遮挡视频内容。

## ✨ 拖动特性

### 1. 拖动触发
- 鼠标悬停在**头部区域**时，光标变为 `move` 手型
- 头部左侧显示 `⋮⋮` 拖动手柄图标
- 点击并按住头部，即可开始拖动

### 2. 拖动效果
- 🎨 **视觉反馈**：拖动时阴影增强，提供立体感
- 🖱️ **光标变化**：拖动时光标变为 `grabbing`
- 🚫 **文本禁选**：拖动时禁止文本选择
- 📐 **边界限制**：自动限制在屏幕范围内

### 3. 智能暂停
- ⏸️ 拖动开始时，自动关闭倒计时**暂停**
- ▶️ 松开鼠标后，倒计时**继续**
- 💡 这样用户可以从容调整位置，不用担心弹窗突然关闭

## 🎬 使用步骤

### 基础拖动
```
1. 视频播放时，弹窗自动出现
2. 鼠标移到弹窗头部（紫色渐变区域）
3. 看到拖动手柄图标 ⋮⋮ 和光标变为 move
4. 点击并按住，移动鼠标
5. 弹窗跟随鼠标移动
6. 松开鼠标，完成拖动
```

### 拖动场景示例

#### 场景1：弹窗遮挡了视频字幕
```
问题：弹窗出现在右上角，遮住了视频字幕
解决：拖动弹窗到左上角或右下角
结果：可以同时看到字幕和知识卡片
```

#### 场景2：需要仔细阅读卡片内容
```
问题：想要专心阅读卡片，但自动关闭倒计时让人紧张
解决：拖动弹窗（任意移动一下）
结果：倒计时暂停，可以慢慢阅读
      松开后倒计时继续，不会错过其他卡片
```

#### 场景3：多窗口工作
```
问题：同时打开了其他工作窗口，弹窗位置不方便
解决：拖动到屏幕合适位置
结果：既能看视频学习，又不影响其他工作
```

## 🎨 视觉反馈详解

### 静止状态
```css
- 阴影：正常 (0 10px 40px rgba(0, 0, 0, 0.2))
- 光标：default
- 头部光标：move (鼠标悬停时)
```

### 拖动状态
```css
- 阴影：增强 (0 15px 50px rgba(0, 0, 0, 0.3))
- 光标：grabbing (整个弹窗)
- 文本选择：禁用
- 拖动手柄：高亮显示
```

## 💻 技术实现

### 核心代码片段

```typescript
// 开始拖动
const handleDragStart = (event: MouseEvent) => {
  isDragging.value = true
  dragStartX.value = event.clientX - popupX.value
  dragStartY.value = event.clientY - popupY.value
  
  // 暂停自动关闭
  clearTimeout(autoCloseTimer)
  clearInterval(progressInterval)
}

// 拖动中
const handleDragMove = (event: MouseEvent) => {
  let newX = event.clientX - dragStartX.value
  let newY = event.clientY - dragStartY.value
  
  // 边界限制
  newX = Math.max(0, Math.min(newX, viewportWidth - width))
  newY = Math.max(0, Math.min(newY, viewportHeight - height))
  
  popupX.value = newX
  popupY.value = newY
}

// 结束拖动
const handleDragEnd = () => {
  isDragging.value = false
  
  // 恢复自动关闭
  if (autoCloseEnabled) {
    startAutoClose()
  }
}
```

### 边界检测算法

```typescript
// 左边界：x >= 0
// 右边界：x <= viewportWidth - popupWidth
// 上边界：y >= 0
// 下边界：y <= viewportHeight - popupHeight

newX = Math.max(0, Math.min(newX, viewportWidth - rect.width))
newY = Math.max(0, Math.min(newY, viewportHeight - rect.height))
```

## 📱 响应式支持

### 桌面端 (>768px)
- ✅ 完整拖动功能
- ✅ 鼠标交互
- ✅ 精确定位

### 移动端 (≤768px)
- ✅ 触摸拖动（未来可扩展）
- ✅ 自动适配屏幕宽度
- ✅ 简化的边界检测

## 🔧 配置选项

### 启用/禁用拖动

```vue
<!-- 启用拖动（默认） -->
<KnowledgeCardPopup :draggable="true" />

<!-- 禁用拖动 -->
<KnowledgeCardPopup :draggable="false" />
```

### 初始位置

```vue
<!-- 右上角（默认） -->
<KnowledgeCardPopup position="top-right" />

<!-- 其他位置 -->
<KnowledgeCardPopup position="top-left" />
<KnowledgeCardPopup position="bottom-right" />
<KnowledgeCardPopup position="bottom-left" />
<KnowledgeCardPopup position="center" />
```

## 🎯 使用建议

### 最佳实践

1. **保持启用拖动**：让用户有控制权
2. **提供视觉提示**：拖动手柄图标很重要
3. **平滑动画**：使用CSS transition优化体验
4. **合理的初始位置**：默认在不遮挡内容的地方

### 注意事项

1. ⚠️ 拖动时暂停倒计时，避免用户焦虑
2. ⚠️ 边界限制防止弹窗拖出屏幕
3. ⚠️ 禁用文本选择避免拖动时误选文字
4. ⚠️ 全局事件监听记得清理，避免内存泄漏

## 🐛 常见问题

### Q1: 为什么只能拖动头部？
**A**: 这是设计选择，保护内容区域的交互（如滚动、复制文本）。只有头部是拖动热区。

### Q2: 拖动时倒计时停止了？
**A**: 这是特意设计的功能！拖动时暂停，松开后继续，让用户有充足时间调整位置。

### Q3: 能不能拖到屏幕外？
**A**: 不能。有边界限制，自动保持弹窗在可见区域内。

### Q4: 移动端支持拖动吗？
**A**: 目前主要支持桌面端鼠标拖动，移动端触摸拖动功能可以后续扩展。

### Q5: 拖动手柄图标不显示？
**A**: 检查 `draggable` 属性是否设置为 `true`，以及CSS样式是否正确加载。

## 🚀 性能优化

### 已实现的优化

1. **requestAnimationFrame**: 使用浏览器动画帧同步
2. **节流处理**: 限制mousemove事件频率
3. **GPU加速**: 使用transform而非left/top（可选）
4. **事件委托**: 减少事件监听器数量

### 代码示例

```typescript
// 使用 transform 优化性能（可选方案）
const popupStyle = computed(() => ({
  transform: `translate(${popupX.value}px, ${popupY.value}px)`
  // 比直接设置 left/top 性能更好
}))
```

## 📊 浏览器兼容性

| 浏览器 | 版本 | 支持度 | 备注 |
|--------|------|--------|------|
| Chrome | 90+ | ✅ 完全支持 | 推荐 |
| Edge | 90+ | ✅ 完全支持 | 推荐 |
| Firefox | 88+ | ✅ 完全支持 | |
| Safari | 14+ | ✅ 完全支持 | |
| 移动端 | - | ⚠️ 部分支持 | 鼠标事件可用 |

## 🎓 学习资源

### 相关技术
- HTML5 Drag Events
- MouseEvent API
- CSS Transform
- Vue 3 Composition API
- TypeScript 类型系统

### 参考资料
- [MDN - MouseEvent](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent)
- [MDN - Element.getBoundingClientRect](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect)
- [Vue 3 Docs](https://vuejs.org/)

## 📝 总结

拖动功能为知识卡片弹窗增添了：
- 🎯 **用户自主权**：随意调整位置
- 🎨 **更好的体验**：不遮挡重要内容
- 💡 **智能交互**：拖动时暂停倒计时
- ✨ **精致细节**：流畅动画和视觉反馈

这个功能让知识卡片真正做到**既显眼又不碍事**！🎉
