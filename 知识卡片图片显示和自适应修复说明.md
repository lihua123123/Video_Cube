# çŸ¥è¯†å¡ç‰‡å›¾ç‰‡æ˜¾ç¤ºå’Œè‡ªé€‚åº”åŠŸèƒ½ä¿®å¤è¯´æ˜

## ä¿®å¤æ—¥æœŸ
2025å¹´12æœˆ3æ—¥

## é—®é¢˜æè¿°
1. çŸ¥è¯†å¡ç‰‡å¼¹çª—ä¸­å›¾ç‰‡æ˜¾ç¤ºä¸º HTML ä»£ç æ–‡æœ¬ï¼Œè€Œä¸æ˜¯æ¸²æŸ“çš„å›¾ç‰‡
2. å›¾ç‰‡æ²¡æœ‰è‡ªé€‚åº”å¤§å°ï¼Œå¯èƒ½è¶…å‡ºå®¹å™¨èŒƒå›´
3. ä¸åŒç»„ä»¶ä¸­çš„å›¾ç‰‡å¤„ç†é€»è¾‘ä¸ä¸€è‡´

## ä¿®å¤å†…å®¹

### 1. KnowledgeCardPopup.vue (çŸ¥è¯†å¡ç‰‡å¼¹çª—)

#### 1.1 å›¾ç‰‡ URL è½¬æ¢é€»è¾‘ä¿®å¤
**ä½ç½®**: `formatContent` å‡½æ•°ä¸­çš„å›¾ç‰‡å¤„ç†éƒ¨åˆ†

**ä¿®å¤å‰**:
```javascript
// ç®€å•çš„ URL å¤„ç†ï¼Œæ²¡æœ‰è€ƒè™‘æ—§ URL æ ¼å¼
if (!url.startsWith('http') && !url.startsWith('/')) {
  imageUrl = '/' + url;
}
```

**ä¿®å¤å**:
```javascript
// å®Œæ•´çš„ URL è½¬æ¢é€»è¾‘
// 1. ä¿®å¤æ—§çš„ localhost:5173 URL
if (url.includes('localhost:5173/uploads/')) {
  imageUrl = url.replace('http://localhost:5173/uploads/', 'http://localhost:3000/uploads/');
}
// 2. å¤„ç†å®Œæ•´ URL
else if (url.startsWith('http://') || url.startsWith('https://')) {
  imageUrl = url;
}
// 3. å¤„ç† /uploads/ ç›¸å¯¹è·¯å¾„
else if (url.startsWith('/uploads/')) {
  imageUrl = 'http://localhost:3000' + url;
}
// 4. å¤„ç†æ— å‰ç¼€çš„ç›¸å¯¹è·¯å¾„
else if (!url.startsWith('/')) {
  imageUrl = 'http://localhost:3000/' + url;
}
```

#### 1.2 è‡ªåŠ¨é“¾æ¥è½¬æ¢ä¿®å¤
**é—®é¢˜**: ä½¿ç”¨äº†ä¸å®‰å…¨çš„æ­£åˆ™è¡¨è¾¾å¼å›è°ƒï¼Œå¯èƒ½å¯¼è‡´ Vue å†…éƒ¨é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆ**: é‡‡ç”¨"ä¿æŠ¤-æ›¿æ¢-æ¢å¤"ç­–ç•¥
```javascript
// 1. ä¿æŠ¤é˜¶æ®µ - ç”¨å ä½ç¬¦æ›¿æ¢ img å’Œ a æ ‡ç­¾
const protectedTags: { [key: string]: string } = {};
formatted = formatted.replace(/<(img|a)[^>]*>/gi, (match) => {
  const key = `__PROTECTED_TAG_${tagCounter++}__`;
  protectedTags[key] = match;
  return key;
});

// 2. æ›¿æ¢é˜¶æ®µ - å®‰å…¨åœ°è½¬æ¢ URL
formatted = formatted.replace(/(https?:\/\/[^\s<>"]+)/gi, '<a href="$1" ...>$1</a>');

// 3. æ¢å¤é˜¶æ®µ - æ¢å¤è¢«ä¿æŠ¤çš„æ ‡ç­¾
Object.keys(protectedTags).forEach(key => {
  if (protectedTags[key]) {
    formatted = formatted.replace(key, protectedTags[key]);
  }
});
```

#### 1.3 å›¾ç‰‡æ ·å¼è‡ªé€‚åº”
**æ–°å¢ CSS**:
```css
.content-wrapper :deep(img),
.content-wrapper :deep(.content-image),
.content-wrapper :deep(.popup-image) {
  max-width: 100%;
  width: auto;
  height: auto;
  display: block;
  margin: 12px auto;
  object-fit: contain;
  max-height: 400px; /* é»˜è®¤æœ€å¤§é«˜åº¦ */
}

/* å°å°ºå¯¸å¼¹çª— */
.size-small .content-wrapper :deep(img) {
  max-height: 200px;
}

/* ä¸­å°ºå¯¸å¼¹çª— */
.size-medium .content-wrapper :deep(img) {
  max-height: 300px;
}

/* å¤§å°ºå¯¸å¼¹çª— */
.size-large .content-wrapper :deep(img) {
  max-height: 500px;
}

/* æ‚¬åœæ•ˆæœ */
.content-wrapper :deep(img:hover) {
  transform: scale(1.02);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
```

### 2. KnowledgeCardDisplay.vue (ä¾§è¾¹æ çŸ¥è¯†å¡ç‰‡)

#### 2.1 å›¾ç‰‡æ ·å¼ä¼˜åŒ–
```css
.content-preview img,
.content-preview img.preview-image,
.content-preview img.content-image {
  max-width: 100%;
  width: auto;
  height: auto;
  margin: 8px auto;
  max-height: 150px; /* æŠ˜å çŠ¶æ€ */
  object-fit: contain;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

/* å±•å¼€çŠ¶æ€å…è®¸æ›´å¤§å°ºå¯¸ */
.knowledge-card.expanded .content-preview img {
  max-height: 300px;
}

/* æ‚¬åœæ•ˆæœ */
.content-preview img:hover {
  transform: scale(1.02);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
```

### 3. EditPage.vue (ç¼–è¾‘é¡µé¢„è§ˆ)

#### 3.1 é¢„è§ˆåŒºåŸŸå›¾ç‰‡æ ·å¼
```css
.preview-content-wrapper img,
.preview-content-wrapper .content-image {
  max-width: 100%;
  width: auto;
  height: auto;
  margin: 16px auto;
  max-height: 400px;
  object-fit: contain;
  cursor: zoom-in;
  transition: transform 0.2s, box-shadow 0.2s;
}

.preview-content-wrapper img:hover,
.preview-content-wrapper .content-image:hover {
  transform: scale(1.02);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
```

### 4. UserPage.vue (ç”¨æˆ·é¡µé¢)

#### 4.1 è¯­æ³•é”™è¯¯ä¿®å¤
**é—®é¢˜**: CSS ä¸­ `padding:` å±æ€§ç¼ºå°‘å€¼

**ä¿®å¤å‰**:
```css
.notification {
  padding:  /* ç¼ºå°‘å€¼ */
  border-radius: 4px;
}
```

**ä¿®å¤å**:
```css
.notification {
  padding: 12px 20px;
  border-radius: 4px;
}
```

#### 4.2 videoId ç±»å‹æ¯”è¾ƒä¿®å¤
**é—®é¢˜**: åç«¯è¿”å›å­—ç¬¦ä¸² `"35"`,å‰ç«¯æ˜¯æ•°å­— `35`,ä¸¥æ ¼æ¯”è¾ƒå¤±è´¥

**ä¿®å¤**: ä½¿ç”¨å®½æ¾æ¯”è¾ƒ `!=` ä»£æ›¿ä¸¥æ ¼æ¯”è¾ƒ `!==`
```javascript
// ä¿®å¤å‰
if (card.video_id !== videoId.value) { ... }

// ä¿®å¤å  
if (card.video_id != videoId.value) { ... }
```

#### 4.3 æ–°å¢è°ƒè¯•åŠŸèƒ½
- æ·»åŠ äº†"ğŸ”„ åˆ·æ–°"æŒ‰é’® - å¼ºåˆ¶é‡æ–°åŠ è½½çŸ¥è¯†å¡ç‰‡
- æ·»åŠ äº†åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ â³
- æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—è¾“å‡º

## æŠ€æœ¯è¦ç‚¹

### å›¾ç‰‡è‡ªé€‚åº”åŸç†
1. **max-width: 100%** - ç¡®ä¿å›¾ç‰‡ä¸è¶…å‡ºå®¹å™¨å®½åº¦
2. **width: auto** - ä¿æŒåŸå§‹å®½é«˜æ¯”
3. **height: auto** - è‡ªåŠ¨è®¡ç®—é«˜åº¦
4. **object-fit: contain** - å›¾ç‰‡å®Œæ•´æ˜¾ç¤ºåœ¨å®¹å™¨å†…
5. **max-height** - é™åˆ¶æœ€å¤§é«˜åº¦,é¿å…è¿‡å¤§
6. **margin: auto** - æ°´å¹³å±…ä¸­æ˜¾ç¤º

### URL è½¬æ¢é€»è¾‘
æ”¯æŒä»¥ä¸‹æ ¼å¼çš„å›¾ç‰‡ URL:
1. å®Œæ•´ URL: `http://localhost:3000/uploads/images/xxx.png`
2. ç›¸å¯¹è·¯å¾„: `/uploads/images/xxx.png`
3. æ— å‰ç¼€è·¯å¾„: `uploads/images/xxx.png`
4. æ—§æ ¼å¼ URL: `http://localhost:5173/uploads/...` (è‡ªåŠ¨è½¬æ¢)

### æ­£åˆ™è¡¨è¾¾å¼å®‰å…¨æ€§
é‡‡ç”¨"ä¿æŠ¤-æ›¿æ¢-æ¢å¤"ä¸‰æ­¥ç­–ç•¥:
1. **ä¿æŠ¤**: ç”¨å ä½ç¬¦æ›¿æ¢å·²æœ‰çš„ HTML æ ‡ç­¾
2. **æ›¿æ¢**: å®‰å…¨åœ°è½¬æ¢çº¯æ–‡æœ¬ URL ä¸ºé“¾æ¥
3. **æ¢å¤**: è¿˜åŸè¢«ä¿æŠ¤çš„æ ‡ç­¾

ä¼˜åŠ¿:
- é¿å…å¤æ‚çš„æ­£å‘/è´Ÿå‘æ–­è¨€
- ä¸ä¾èµ–å­—ç¬¦ä¸²åˆ‡ç‰‡æ“ä½œ
- ä¸ä¼šå¯¼è‡´ Vue å†…éƒ¨é”™è¯¯
- é€»è¾‘æ¸…æ™°æ˜“ç»´æŠ¤

## æµ‹è¯•å»ºè®®

### 1. å›¾ç‰‡æ˜¾ç¤ºæµ‹è¯•
- [ ] æ£€æŸ¥å¼¹çª—ä¸­çš„å›¾ç‰‡æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
- [ ] æ£€æŸ¥ä¾§è¾¹æ ä¸­çš„å›¾ç‰‡æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
- [ ] æ£€æŸ¥ç¼–è¾‘é¡µé¢„è§ˆä¸­çš„å›¾ç‰‡æ˜¯å¦æ­£ç¡®æ˜¾ç¤º

### 2. å›¾ç‰‡è‡ªé€‚åº”æµ‹è¯•
- [ ] ä¸Šä¼ ä¸åŒå°ºå¯¸çš„å›¾ç‰‡(å°ã€ä¸­ã€å¤§)
- [ ] æ£€æŸ¥å›¾ç‰‡æ˜¯å¦æŒ‰æ¯”ä¾‹ç¼©æ”¾
- [ ] æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å±…ä¸­æ˜¾ç¤º
- [ ] æµ‹è¯•ä¸åŒå¼¹çª—å°ºå¯¸(small/medium/large)ä¸‹çš„å›¾ç‰‡æ˜¾ç¤º

### 3. äº¤äº’æµ‹è¯•
- [ ] æ‚¬åœåœ¨å›¾ç‰‡ä¸Š,æ£€æŸ¥ç¼©æ”¾æ•ˆæœ
- [ ] ç‚¹å‡»åˆ·æ–°æŒ‰é’®,éªŒè¯åŠŸèƒ½
- [ ] æ£€æŸ¥è‡ªåŠ¨ä¿®å¤æŒ‰é’®åŠŸèƒ½

### 4. å…¼å®¹æ€§æµ‹è¯•
- [ ] æµ‹è¯•æ—§æ ¼å¼ URL çš„è‡ªåŠ¨è½¬æ¢
- [ ] æµ‹è¯•ä¸åŒæ ¼å¼çš„ç›¸å¯¹è·¯å¾„
- [ ] æµ‹è¯•æ··åˆå†…å®¹(å›¾ç‰‡+é“¾æ¥+æ–‡æœ¬)

## æ³¨æ„äº‹é¡¹

1. **æ¸…é™¤ç¼“å­˜**: ä¿®æ”¹ååŠ¡å¿…å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ (Ctrl+F5)
2. **æ£€æŸ¥æ§åˆ¶å°**: æŸ¥çœ‹æ˜¯å¦æœ‰å›¾ç‰‡åŠ è½½é”™è¯¯æˆ– CORS é—®é¢˜
3. **URL æ ¼å¼**: ç¡®ä¿åç«¯è¿”å›çš„å›¾ç‰‡ URL æ ¼å¼æ­£ç¡®
4. **CORS é…ç½®**: ç¡®è®¤åç«¯ CORS è®¾ç½®å…è®¸å‰ç«¯è®¿é—®

## ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
1. `Frontend/src/components/KnowledgeCardPopup.vue`
2. `Frontend/src/components/KnowledgeCardDisplay.vue`
3. `Frontend/src/views/EditPage.vue`
4. `Frontend/src/views/UserPage.vue`
5. `Backend/app.js` (è·¯ç”±ä¿®å¤)

### æ–°å¢åŠŸèƒ½
1. å¼ºåˆ¶åˆ·æ–°çŸ¥è¯†å¡ç‰‡åŠŸèƒ½ (`forceRefreshCards`)
2. åŠ è½½çŠ¶æ€å¯è§†åŒ–
3. è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—è¾“å‡º

## æ€»ç»“

æ­¤æ¬¡ä¿®å¤è§£å†³äº†çŸ¥è¯†å¡ç‰‡ä¸­å›¾ç‰‡æ— æ³•æ˜¾ç¤ºçš„æ ¸å¿ƒé—®é¢˜,å¹¶å®ç°äº†å›¾ç‰‡è‡ªé€‚åº”å¤§å°åŠŸèƒ½ã€‚ä¸»è¦æ”¹è¿›åŒ…æ‹¬:

âœ… ç»Ÿä¸€äº†æ‰€æœ‰ç»„ä»¶çš„å›¾ç‰‡ URL å¤„ç†é€»è¾‘
âœ… å®ç°äº†å®‰å…¨çš„è‡ªåŠ¨é“¾æ¥è½¬æ¢
âœ… æ·»åŠ äº†å“åº”å¼çš„å›¾ç‰‡å°ºå¯¸æ§åˆ¶
âœ… ä¼˜åŒ–äº†ç”¨æˆ·ä½“éªŒ(æ‚¬åœæ•ˆæœã€å±…ä¸­æ˜¾ç¤º)
âœ… ä¿®å¤äº†è¯­æ³•é”™è¯¯å’Œç±»å‹æ¯”è¾ƒé—®é¢˜
âœ… æ–°å¢äº†è°ƒè¯•å’Œåˆ·æ–°åŠŸèƒ½

æ‰€æœ‰ä¿®æ”¹å‡å·²å®Œæˆ,å»ºè®®ç«‹å³æµ‹è¯•éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚
