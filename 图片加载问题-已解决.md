# ğŸ‰ å›¾ç‰‡åŠ è½½é—®é¢˜ - å·²è§£å†³ï¼

## âœ… é—®é¢˜ç¡®è®¤

**æµ‹è¯•ç»“æœ**:
```powershell
Invoke-WebRequest -Uri "http://localhost:5173/uploads/images/01466abb-935a-470d-b3fd-1ccfb87ef2ff.png" -Method Head

StatusCode: 200 OK âœ“
```

**ç»“è®º**: **å‰ç«¯ä»£ç†é…ç½®æ­£å¸¸ï¼Œå›¾ç‰‡å¯ä»¥æ­£å¸¸è®¿é—®ï¼**

---

## ğŸ” æ ¹æœ¬åŸå› 

### é—®é¢˜ä¸æ˜¯ä»£ç ï¼Œæ˜¯**ç«¯å£å’Œç¼“å­˜**ï¼

1. **å¤šä¸ª Node è¿›ç¨‹è¿è¡Œ**
   - æœ‰å¤šä¸ª Vite å®ä¾‹åœ¨ä¸åŒç«¯å£ (5173, 5174)
   - æµè§ˆå™¨ç¼“å­˜äº†æ—§çš„ 5173 å®ä¾‹ï¼ˆæ— ä»£ç†é…ç½®ï¼‰
   - æ–°çš„ä»£ç†é…ç½®åœ¨ 5174 ä¸Šï¼Œä½†æµè§ˆå™¨è®¿é—® 5173

2. **æµè§ˆå™¨ç¼“å­˜**
   - Service Worker ç¼“å­˜
   - HTTP ç¼“å­˜
   - DNS ç¼“å­˜

3. **ç«¯å£å†²çª**
   - å¤šæ¬¡é‡å¯å¯¼è‡´åƒµå°¸è¿›ç¨‹å ç”¨ç«¯å£
   - Vite è‡ªåŠ¨åˆ‡æ¢ç«¯å£å¯¼è‡´æ··ä¹±

---

## âœ… å·²æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤

### 1. åœæ­¢æ‰€æœ‰ Node è¿›ç¨‹
```powershell
taskkill /F /IM node.exe
```

### 2. éªŒè¯ç«¯å£é‡Šæ”¾
```powershell
netstat -ano | findstr "5173"
netstat -ano | findstr "3000"
```

### 3. é‡å¯æœåŠ¡ï¼ˆæ­£ç¡®çš„ç«¯å£ï¼‰
```powershell
# åç«¯ (3000)
cd d:\Code\nodejs\Video_Cube\Backend
npm run start

# å‰ç«¯ (5173)
cd d:\Code\nodejs\Video_Cube\Frontend
npm exec vite
```

### 4. éªŒè¯ä»£ç†å·¥ä½œ
```powershell
# æµ‹è¯•åç«¯
Invoke-WebRequest -Uri "http://localhost:3000/uploads/images/xxx.png" -Method Head
# ç»“æœ: 200 OK âœ“

# æµ‹è¯•å‰ç«¯ä»£ç†
Invoke-WebRequest -Uri "http://localhost:5173/uploads/images/xxx.png" -Method Head  
# ç»“æœ: 200 OK âœ“
```

---

## ğŸ¯ ä½ éœ€è¦åšçš„æœ€åæ­¥éª¤

### âš ï¸ å…³é”®ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜

1. **æŒ‰ `Ctrl + Shift + Delete`**
2. é€‰æ‹©ï¼š
   - âœ… ç¼“å­˜çš„å›¾åƒå’Œæ–‡ä»¶
   - âœ… Cookie å’Œç½‘ç«™æ•°æ®
   - âœ… æ—¶é—´èŒƒå›´ï¼šå…¨éƒ¨
3. **ç‚¹å‡»"æ¸…é™¤æ•°æ®"**

### ğŸ”„ æˆ–è€…ä½¿ç”¨ç¡¬åˆ·æ–°

**åœ¨é¡µé¢ä¸ŠæŒ‰ `Ctrl + Shift + R`** (ç¡¬åˆ·æ–°ï¼Œç»•è¿‡ç¼“å­˜)

### ğŸŒŸ æˆ–è€…ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•

**æŒ‰ `Ctrl + Shift + N`** æ‰“å¼€æ— ç—•çª—å£ï¼Œè®¿é—® `http://localhost:5173`

---

## ğŸ§ª éªŒè¯æ­¥éª¤

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)

### 2. åˆ‡æ¢åˆ° Network æ ‡ç­¾

### 3. å‹¾é€‰ "Disable cache"

### 4. ä¸Šä¼ æ–°å›¾ç‰‡ï¼Œè§‚å¯Ÿï¼š

**æœŸæœ›çœ‹åˆ°çš„æˆåŠŸæ—¥å¿—**:
```javascript
// Console æ ‡ç­¾
âœ… å›¾ç‰‡ä¸Šä¼ æˆåŠŸ: {status: true, message: 'å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', data: {url: '/uploads/images/xxx.png'}}
âœ… æ’å…¥å›¾ç‰‡URL: /uploads/images/xxx.png
âœ… åŸå§‹å›¾ç‰‡URL: /uploads/images/xxx.png
âœ… å¤„ç†åå›¾ç‰‡URL: /uploads/images/xxx.png

// Network æ ‡ç­¾
Request URL: http://localhost:5173/uploads/images/xxx.png
Status: 200 OK
Type: png
Size: xxx KB
```

**å¦‚æœä»ç„¶å¤±è´¥ï¼Œä¼šçœ‹åˆ°**:
```javascript
âŒ Request URL: http://localhost:5173/uploads/images/xxx.png
âŒ Status: 404 Not Found
// æˆ–è€…
âŒ Status: (failed) net::ERR_CONNECTION_REFUSED
```

---

## ğŸ“Š å®Œæ•´çš„å·¥ä½œæµç¨‹

### ä¸Šä¼ æµç¨‹ï¼ˆç°åœ¨åº”è¯¥æ­£å¸¸ï¼‰

```
ç”¨æˆ·ç‚¹å‡»å·¥å…·æ å›¾ç‰‡æŒ‰é’®
    â†“
é€‰æ‹©å›¾ç‰‡æ–‡ä»¶
    â†“
Toast UI Editor è°ƒç”¨ addImageBlobHook
    â†“
POST http://localhost:5173/api/admin/videos/upload-image
    â†“
Vite ä»£ç†: /api â†’ http://localhost:3000/admin/videos/upload-image
    â†“
åç«¯ Multer å¤„ç†ä¸Šä¼ 
    â†“
ä¿å­˜: Backend/public/uploads/images/{uuid}.png
    â†“
è¿”å›: {data: {url: '/uploads/images/{uuid}.png'}}
    â†“
Toast UI Editor æ’å…¥: ![image](/uploads/images/{uuid}.png)
    â†“
âœ… Markdown å†…å®¹æ›´æ–°
```

### æ˜¾ç¤ºæµç¨‹ï¼ˆç°åœ¨åº”è¯¥æ­£å¸¸ï¼‰

```
æµè§ˆå™¨è§£æ Markdown
    â†“
å‘ç°å›¾ç‰‡: ![image](/uploads/images/{uuid}.png)
    â†“
è¯·æ±‚: http://localhost:5173/uploads/images/{uuid}.png
    â†“
Vite ä»£ç†: /uploads â†’ http://localhost:3000/uploads/images/{uuid}.png
    â†“
åç«¯ Express é™æ€æ–‡ä»¶æœåŠ¡
    â†“
è¯»å–: Backend/public/uploads/images/{uuid}.png
    â†“
è¿”å›: 200 OK + å›¾ç‰‡æ•°æ®
    â†“
æµè§ˆå™¨æ¥æ”¶å›¾ç‰‡æ•°æ®
    â†“
âœ… å›¾ç‰‡æ˜¾ç¤ºåœ¨é¡µé¢
```

---

## ğŸ› ï¸ ä»£ç†é…ç½®è¯¦è§£

### vite.config.ts (å·²ç¡®è®¤æ­£ç¡®)

```typescript
server: {
  proxy: {
    // API ä»£ç† (ç”¨äºä¸Šä¼ )
    '/api': {
      target: 'http://localhost:3000',  // åç«¯åœ°å€
      changeOrigin: true,                 // ä¿®æ”¹ Origin å¤´
      rewrite: (path) => path.replace(/^\/api/, ''),  // ç§»é™¤ /api å‰ç¼€
      configure: (proxy, options) => {
        proxy.on('proxyReq', (proxyReq, req, res) => {
          // ä¿ç•™ Content-Type å¤´ï¼ˆmultipart boundaryï¼‰
          if (req.headers['content-type']) {
            proxyReq.setHeader('Content-Type', req.headers['content-type']);
          }
        });
      }
    },
    // å›¾ç‰‡ä»£ç† (ç”¨äºæ˜¾ç¤º)
    '/uploads': {
      target: 'http://localhost:3000',  // åç«¯åœ°å€
      changeOrigin: true,                 // ä¿®æ”¹ Origin å¤´
      secure: false                       // å…è®¸ HTTP (ä¸æ˜¯ HTTPS)
    }
  }
}
```

### åç«¯é…ç½® (app.js - å·²ç¡®è®¤æ­£ç¡®)

```javascript
// é™æ€æ–‡ä»¶æœåŠ¡
app.use(express.static(path.join(__dirname, 'public')));

// ä¸Šä¼ ç›®å½•ï¼ˆæ–°ä½ç½®ï¼‰
app.use('/uploads', express.static(path.join(__dirname, 'public', 'uploads')));

// å…¼å®¹æ—§ä½ç½®
app.use('/uploads', express.static(path.join(__dirname, 'uploads')));
```

---

## ğŸ¯ æ•…éšœæ’æŸ¥æ¸…å•

å¦‚æœå›¾ç‰‡ä»ç„¶æ— æ³•æ˜¾ç¤ºï¼ŒæŒ‰é¡ºåºæ£€æŸ¥ï¼š

### âœ… 1. æœåŠ¡è¿è¡ŒçŠ¶æ€
```powershell
# åç«¯åº”è¯¥åœ¨ 3000
netstat -ano | findstr "3000"
# åº”è¯¥æ˜¾ç¤º: TCP    127.0.0.1:3000    LISTENING

# å‰ç«¯åº”è¯¥åœ¨ 5173 (ä¸æ˜¯ 5174!)
netstat -ano | findstr "5173"
# åº”è¯¥æ˜¾ç¤º: TCP    127.0.0.1:5173    LISTENING
```

### âœ… 2. æ–‡ä»¶å­˜åœ¨
```powershell
dir "d:\Code\nodejs\Video_Cube\Backend\public\uploads\images"
# åº”è¯¥çœ‹åˆ°ä½ ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶
```

### âœ… 3. åç«¯å¯è®¿é—®
```powershell
Invoke-WebRequest -Uri "http://localhost:3000/uploads/images/{ä½ çš„å›¾ç‰‡}.png" -Method Head
# åº”è¯¥è¿”å›: StatusCode: 200
```

### âœ… 4. å‰ç«¯ä»£ç†å¯è®¿é—®
```powershell
Invoke-WebRequest -Uri "http://localhost:5173/uploads/images/{ä½ çš„å›¾ç‰‡}.png" -Method Head
# åº”è¯¥è¿”å›: StatusCode: 200
```

### âœ… 5. æµè§ˆå™¨è®¿é—®
æ‰“å¼€: `http://localhost:5173/uploads/images/01466abb-935a-470d-b3fd-1ccfb87ef2ff.png`
åº”è¯¥ç›´æ¥æ˜¾ç¤ºå›¾ç‰‡

---

## ğŸ”§ å¿«é€Ÿä¿®å¤è„šæœ¬

æˆ‘å·²åˆ›å»º `fix-image-loading.ps1`ï¼Œåœ¨ PowerShell ä¸­è¿è¡Œï¼š

```powershell
cd d:\Code\nodejs\Video_Cube
.\fix-image-loading.ps1
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. âœ… åœæ­¢æ‰€æœ‰ Node è¿›ç¨‹
2. âœ… éªŒè¯ç«¯å£é‡Šæ”¾
3. âœ… æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶
4. âœ… å¯åŠ¨åç«¯ (3000)
5. âœ… å¯åŠ¨å‰ç«¯ (5173)
6. âœ… æµ‹è¯•è¿æ¥

---

## ğŸ’¡ é¢„é˜²æªæ–½

### 1. ä½¿ç”¨å›ºå®šç«¯å£

ä¿®æ”¹ `vite.config.ts`:
```typescript
export default defineConfig({
  server: {
    port: 5173,        // å›ºå®šç«¯å£
    strictPort: true,  // å¦‚æœå ç”¨å°±æŠ¥é”™ï¼ˆä¸è‡ªåŠ¨åˆ‡æ¢ï¼‰
    // ...proxy config...
  }
})
```

### 2. å¼€å‘æ—¶å…³é—­ç¼“å­˜

åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…· Network æ ‡ç­¾ï¼š
- âœ… å‹¾é€‰ "Disable cache"

### 3. ä½¿ç”¨è¿›ç¨‹ç®¡ç†å·¥å…·

å®‰è£… PM2:
```powershell
npm install -g pm2

# å¯åŠ¨åç«¯
pm2 start d:\Code\nodejs\Video_Cube\Backend\bin\www --name video-backend

# å¯åŠ¨å‰ç«¯
pm2 start "npm run dev" --name video-frontend --cwd d:\Code\nodejs\Video_Cube\Frontend

# æŸ¥çœ‹çŠ¶æ€
pm2 list

# åœæ­¢æ‰€æœ‰
pm2 stop all
```

---

## ğŸ“ æ€»ç»“

### é—®é¢˜è¯Šæ–­ç»“æœ

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å›¾ç‰‡æ–‡ä»¶å­˜åœ¨ | âœ… | Backend/public/uploads/images/ |
| åç«¯é™æ€æœåŠ¡ | âœ… | Express static middleware |
| åç«¯å›¾ç‰‡è®¿é—® | âœ… | http://localhost:3000/uploads/images/ |
| Vite ä»£ç†é…ç½® | âœ… | /uploads â†’ :3000 |
| å‰ç«¯ä»£ç†è®¿é—® | âœ… | http://localhost:5173/uploads/images/ |
| æµè§ˆå™¨ç¼“å­˜ | âš ï¸ | **éœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ¸…é™¤** |

### æ ¸å¿ƒé—®é¢˜

**ä¸æ˜¯ä»£ç é—®é¢˜ï¼Œæ˜¯è¿ç»´é—®é¢˜ï¼**

1. âŒ å¤šä¸ª Node è¿›ç¨‹å¯¼è‡´ç«¯å£æ··ä¹±
2. âŒ æµè§ˆå™¨ç¼“å­˜æ—§çš„æ— ä»£ç†é…ç½®å®ä¾‹
3. âŒ ç”¨æˆ·è®¿é—®çš„ç«¯å£å’Œå®é™…è¿è¡Œç«¯å£ä¸ä¸€è‡´

### è§£å†³æ–¹æ¡ˆ

1. âœ… åœæ­¢æ‰€æœ‰ Node è¿›ç¨‹
2. âœ… åœ¨æ­£ç¡®çš„ç«¯å£å¯åŠ¨æœåŠ¡ (5173 + 3000)
3. âš ï¸ **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜** (ç”¨æˆ·æ“ä½œ)
4. âœ… ä½¿ç”¨ `Ctrl+Shift+R` ç¡¬åˆ·æ–°

---

## ğŸ‰ æœ€ç»ˆç¡®è®¤

**ä»£ç†æµ‹è¯•æˆåŠŸ**: `http://localhost:5173/uploads/images/xxx.png` â†’ **200 OK** âœ…

**ç°åœ¨åªéœ€è¦**:
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ (Ctrl+Shift+Delete)
2. åˆ·æ–°é¡µé¢ (Ctrl+Shift+R)
3. æµ‹è¯•ä¸Šä¼ æ–°å›¾ç‰‡

**å›¾ç‰‡åº”è¯¥å¯ä»¥æ­£å¸¸æ˜¾ç¤ºäº†ï¼** ğŸŠ
